<head><script type="module">var e={42:(e,t)=>{t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}}},t={};const n=VueRouter,a=Vue,o={class:'action-menu-header'},l={class:'action-menu-content'},c={key:0},i={key:1},r={class:'quantity-input'},s={class:'quantity-controls'},p=['disabled'],m=['max'],d=['disabled'],u={class:'quantity-max'},v={key:2},f={key:3},g={key:4},y={key:5},b={class:'npc-inventory-content'},E={class:'inventory-section'},k={class:'inventory-items'},N=['id','value'],h=['for'],V={class:'inventory-section'},C={class:'inventory-items'},B=['id','value'],w=['for'],S=['disabled'],x=(0,a.defineComponent)({__name:'ActionMenu',props:{visible:{type:Boolean},type:{},title:{},position:{},maxQuantity:{default:99},isEquipped:{type:Boolean,default:!1},target:{default:()=>{}}},emits:['select','close'],setup(e,{emit:t}){const n=t,x=(0,a.ref)(1),D=(0,a.ref)([]);function q(){x.value<1&&(x.value=1),x.value>e.maxQuantity&&(x.value=e.maxQuantity)}function T(){x.value<e.maxQuantity&&x.value++}function A(){x.value>1&&x.value--}function I(t){'item'===e.type?n('select',t,x.value):'npc_inventory'===e.type?n('select',t,void 0,D.value):n('select',t),n('close')}function F(){n('close')}function M(){const t=e.target;if(!t||!t.inventory)return[];const n=[];if(t.inventory.weapon){t.inventory.weapon.split(/,|，/).map(e=>e.trim()).filter(Boolean).forEach(e=>{n.push({name:O(e),color:P(e)})})}if(t.inventory.armor){t.inventory.armor.split(/,|，/).map(e=>e.trim()).filter(Boolean).forEach(e=>{n.push({name:O(e),color:P(e)})})}if(t.inventory.accessories){t.inventory.accessories.split(/,|，/).map(e=>e.trim()).filter(Boolean).forEach(e=>{n.push({name:O(e),color:P(e)})})}return n}function L(){const t=e.target;return t&&t.inventory&&t.inventory.items?t.inventory.items.map(e=>({name:function(e){const t=e.match(/^([^(]+)/);return t?t[1].trim():e}(e),display:e})):[]}function O(e){const t=e.match(/^([^(]+)/);return t?t[1].trim():e}function P(e){const t=e.match(/\(([^)]+)\)$/);if(!t)return'#ffffff';return{普通:'#ffffff',精良:'#00ff00',稀有:'#0080ff',史诗:'#ff00ff',传奇:'#ffd700'}[t[1].trim()]||'#ffffff'}return(0,a.watch)(()=>e.visible,e=>{e&&(x.value=1,D.value=[])}),(t,n)=>e.visible?((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:0,class:'action-menu-overlay',onClick:F},[(0,a.createElementVNode)('div',{class:'action-menu',style:(0,a.normalizeStyle)({left:e.position.x+'px',top:e.position.y+'px'}),onClick:n[18]||(n[18]=(0,a.withModifiers)(()=>{},['stop']))},[(0,a.createElementVNode)('div',o,[(0,a.createElementVNode)('h4',null,(0,a.toDisplayString)(e.title),1)]),(0,a.createElementVNode)('div',l,['ability'===e.type?((0,a.openBlock)(),(0,a.createElementBlock)('div',c,[(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[0]||(n[0]=e=>I('use'))},'使用'),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[1]||(n[1]=e=>I('study'))},'研习')])):'item'===e.type?((0,a.openBlock)(),(0,a.createElementBlock)('div',i,[(0,a.createElementVNode)('div',r,[n[19]||(n[19]=(0,a.createElementVNode)('label',null,'数量：',-1)),(0,a.createElementVNode)('div',s,[(0,a.createElementVNode)('button',{class:'quantity-btn',disabled:x.value<=1,onClick:A},'-',8,p),(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':n[2]||(n[2]=e=>x.value=e),type:'number',min:'1',max:e.maxQuantity,class:'quantity-field',onChange:q},null,40,m),[[a.vModelText,x.value,void 0,{number:!0}]]),(0,a.createElementVNode)('button',{class:'quantity-btn',disabled:x.value>=e.maxQuantity,onClick:T},'+',8,d)]),(0,a.createElementVNode)('span',u,'/'+(0,a.toDisplayString)(e.maxQuantity),1)]),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[3]||(n[3]=e=>I('use'))},'使用'),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[4]||(n[4]=e=>I('give'))},'给予'),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[5]||(n[5]=e=>I('discard'))},'丢弃')])):'quest'===e.type?((0,a.openBlock)(),(0,a.createElementBlock)('div',v,[(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[6]||(n[6]=e=>I('start'))},'开始任务'),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[7]||(n[7]=e=>I('abandon'))},'放弃任务')])):'equipment'===e.type?((0,a.openBlock)(),(0,a.createElementBlock)('div',f,[e.isEquipped?((0,a.openBlock)(),(0,a.createElementBlock)('button',{key:0,class:'action-btn',onClick:n[8]||(n[8]=e=>I('unequip'))},'卸下')):((0,a.openBlock)(),(0,a.createElementBlock)('button',{key:1,class:'action-btn',onClick:n[9]||(n[9]=e=>I('equip'))},'装备')),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[10]||(n[10]=e=>I('give'))},'给予'),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[11]||(n[11]=e=>I('discard'))},'丢弃')])):'rest'===e.type?((0,a.openBlock)(),(0,a.createElementBlock)('div',g,[(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[12]||(n[12]=e=>I('nap'))},'小憩'),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[13]||(n[13]=e=>I('sleep'))},'就寝'),(0,a.createElementVNode)('button',{class:'action-btn',onClick:n[14]||(n[14]=e=>I('invite'))},'邀请共寝')])):'npc_inventory'===e.type?((0,a.openBlock)(),(0,a.createElementBlock)('div',y,[(0,a.createElementVNode)('div',b,[(0,a.createElementVNode)('div',E,[n[20]||(n[20]=(0,a.createElementVNode)('h5',null,'装备',-1)),(0,a.createElementVNode)('div',k,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(M(),(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name+'-'+t,class:'inventory-item'},[(0,a.withDirectives)((0,a.createElementVNode)('input',{id:'equip-'+t,'onUpdate:modelValue':n[15]||(n[15]=e=>D.value=e),type:'checkbox',value:e.name,class:'item-checkbox'},null,8,N),[[a.vModelCheckbox,D.value]]),(0,a.createElementVNode)('label',{for:'equip-'+t,class:'item-label',style:(0,a.normalizeStyle)({color:e.color})},(0,a.toDisplayString)(e.name),13,h)]))),128))])]),(0,a.createElementVNode)('div',V,[n[21]||(n[21]=(0,a.createElementVNode)('h5',null,'物品',-1)),(0,a.createElementVNode)('div',C,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(L(),e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'inventory-item'},[(0,a.withDirectives)((0,a.createElementVNode)('input',{id:e.name,'onUpdate:modelValue':n[16]||(n[16]=e=>D.value=e),type:'checkbox',value:e.name,class:'item-checkbox'},null,8,B),[[a.vModelCheckbox,D.value]]),(0,a.createElementVNode)('label',{for:e.name,class:'item-label'},(0,a.toDisplayString)(e.display),9,w)]))),128))])])]),(0,a.createElementVNode)('button',{class:'action-btn steal-btn',disabled:!D.value.length,onClick:n[17]||(n[17]=e=>I('steal'))},'偷窃选中物品',8,S)])):(0,a.createCommentVNode)('v-if',!0)])],4)])):(0,a.createCommentVNode)('v-if',!0)}});var D=function n(a){var o=t[a];if(void 0!==o)return o.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,n),l.exports}(42);const q=(0,D.A)(x,[['__scopeId','data-v-ee0818f6']]),T=e=>e?e.trim().split(/,|，/).map(e=>e.trim()).filter(Boolean):[],A=e=>{if(!e)return{};const t=e.getAttribute('HP'),n=e.getAttribute('MP'),a=e.getAttribute('STA'),o={};return t&&(o.hp=`命元：${t}/100`),n&&(o.mp=`神元：${n}/100`),a&&(o.sta=`气力：${a}/100`),o};const I={gufeng:{primaryColor:'#c89b3c',glowColor:'rgba(255, 215, 0, 0.6)',accentColor:'#e74c3c',bondedColor:'#f472b6',bgPanel:'rgba(30, 25, 20, 0.85)',bgSection:'rgba(10, 5, 0, 0.4)',borderSection:'rgba(200, 155, 60, 0.3)',textMain:'#f0e6d2',textHeader:'#c89b3c',bgImage:'url("https://www.transparenttextures.com/patterns/old-wall.png")',titleIconContent:'',titleIconSvg:'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'currentColor\'%3E%3Cpath d=\'M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20ZM15,8H9V16h6Z\'/%3E%3C/svg%3E")',bgCard:'#2a231c',wrapperBorderRadius:'10px',labels:{alignment:'礼仁:',power:'功名:',abilities:'六艺:',titles:'风评:',effects:'迹遇:',equipment:'仪仗:',items:'什物:',currency:'金帛:',time:'春秋:',location:'舆图:',environment:'山水:',dynamics:'朝闻:',questMain:'天命:',questSide:'浮生:',npcPower:'功名:'},tabNames:{tab1:'山河册',tab2:'衣冠谱',tab3:'秉枢行',optionsTitle:'审时度势',worldStatus:'天下大势',factions:'各方角力',inventory:'随行细软',nearby:'萍水相逢',bonded:'朱丝系命',logTitle:'青史遗痕:',collapsedCharTitle:'青衫风华',collapsedWorldTitle:'江山一探',journal:'经世录'}},xianxia:{primaryColor:'#34d399',glowColor:'rgba(167, 243, 208, 0.7)',accentColor:'#f59e0b',bondedColor:'#e53e3e',bgPanel:'rgba(15, 30, 25, 0.85)',bgSection:'rgba(5, 15, 10, 0.4)',borderSection:'rgba(52, 211, 153, 0.3)',textMain:'#e0f2f1',textHeader:'#34d399',bgImage:'url("https://www.transparenttextures.com/patterns/gplay.png")',titleIconContent:'☯',titleIconSvg:'none',bgCard:'#182825',wrapperBorderRadius:'10px',labels:{alignment:'道心:',power:'道境:',abilities:'神通:',titles:'道号:',effects:'道痕:',equipment:'法宝:',items:'灵物:',currency:'灵资:',time:'仙历:',location:'洞天:',environment:'灵氛:',dynamics:'玄讯:',questMain:'天缘:',questSide:'尘缘:',npcPower:'道行:'},tabNames:{tab1:'天机卷',tab2:'仙缘录',tab3:'运玄机',optionsTitle:'妙法自然',worldStatus:'大道气运',factions:'诸天势力',inventory:'袖里乾坤',nearby:'方外客',bonded:'三生缘',logTitle:'天机衍变:',collapsedCharTitle:'御风逍遥',collapsedWorldTitle:'天机一瞥',journal:'天命织锦'}},minsu:{primaryColor:'#ef4444',glowColor:'rgba(252, 165, 165, 0.7)',accentColor:'#facc15',bondedColor:'#facc15',bgPanel:'rgba(40, 10, 10, 0.85)',bgSection:'rgba(20, 0, 0, 0.4)',borderSection:'rgba(239, 68, 68, 0.3)',textMain:'#fef2f2',textHeader:'#fca5a5',bgImage:'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'80\' height=\'80\'%3E%3Cg fill=\'%23a11d1d\' opacity=\'0.35\'%3E%3Cpath d=\'M15 8 C 10 5, 5 10, 8 15 L 12 18 C 15 22, 22 20, 20 15 Z\' /%3E%3Ccircle cx=\'50\' cy=\'10\' r=\'5\' /%3E%3Cellipse cx=\'65\' cy=\'60\' rx=\'8\' ry=\'4\' transform=\'rotate(45 65 60)\' /%3E%3Cpath d=\'M30 70 C 25 75, 35 80, 40 75 L 42 72 C 45 68, 38 65, 35 68 Z\' /%3E%3Ccircle cx=\'10\' cy=\'50\' r=\'3\' /%3E%3Ccircle cx=\'70\' cy=\'30\' r=\'2\' /%3E%3C/g%3E%3C/svg%3E")',titleIconContent:'🏮',titleIconSvg:'none',bgCard:'#3a1a1a',wrapperBorderRadius:'10px',labels:{alignment:'情理:',power:'命格:',abilities:'绝活:',titles:'浑号:',effects:'兆象:',equipment:'法器:',items:'杂货:',currency:'家当:',time:'黄历:',location:'地头:',environment:'风水:',dynamics:'闲话:',questMain:'诡事:',questSide:'插曲:',npcPower:'斤两:'},tabNames:{tab1:'风物志',tab2:'异闻录',tab3:'探吉凶',optionsTitle:'见微知著',worldStatus:'四时八节',factions:'三教九流',inventory:'百宝褡裢',nearby:'市井群像',bonded:'宿缘牵绊',logTitle:'口耳余韵:',collapsedCharTitle:'烛龙之影',collapsedWorldTitle:'辰光一卜',journal:'乡野奇谭'}},wuxia:{primaryColor:'#e5e7eb',glowColor:'rgba(255, 255, 255, 0.3)',accentColor:'#dc2626',bondedColor:'#34d399',bgPanel:'rgba(17, 24, 39, 0.9)',bgSection:'rgba(31, 41, 55, 0.5)',borderSection:'rgba(229, 231, 235, 0.3)',textMain:'#f9fafb',textHeader:'#e5e7eb',bgImage:'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\'%3E%3Cpath d=\'M0 10 H15 V25 H0 V40 H30 V10 H40 V0 H10 V-10\' fill=\'none\' stroke=\'rgba(229, 231, 235, 0.15)\' stroke-width=\'2\'/%3E%3C/svg%3E")',titleIconContent:'',titleIconSvg:'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'currentColor\'%3E%3Cpath d=\'M12.5,2C10.8,2,9.5,3.3,9.5,5s1.3,3,3,3,3-1.3,3-3S14.2,2,12.5,2z M12,9C7.58,9,4,12.58,4,17s3.58,8,8,8,8-3.58,8-8S16.42,9,12,9z\'/%3E%3C/svg%3E")',bgCard:'#2c3342',wrapperBorderRadius:'2px',labels:{alignment:'道义:',power:'功力:',abilities:'武学:',titles:'绰号:',effects:'境况:',equipment:'利器:',items:'奇物:',currency:'盘缠:',time:'光阴:',location:'所在:',environment:'景致:',dynamics:'风波:',questMain:'命途:',questSide:'萍踪:',npcPower:'功力:'},tabNames:{tab1:'侠客行',tab2:'恩仇录',tab3:'决进退',optionsTitle:'当机立断',worldStatus:'江湖风云',factions:'门派帮会',inventory:'英雄行囊',nearby:'江湖过客',bonded:'生死之交',logTitle:'江湖余波:',collapsedCharTitle:'人间惊鸿',collapsedWorldTitle:'风云一望',journal:'肝胆行藏'}},xuanhuan:{primaryColor:'#8b5cf6',glowColor:'rgba(196, 181, 253, 0.6)',accentColor:'#38bdf8',bondedColor:'#38bdf8',bgPanel:'rgba(5, 5, 15, 0.9)',bgSection:'rgba(0, 0, 0, 0.4)',borderSection:'rgba(139, 92, 246, 0.3)',textMain:'#e9d5ff',textHeader:'#c4b5fd',bgImage:'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\'%3E%3Crect width=\'100\' height=\'100\' fill=\'rgba(5,5,15,0)\'/%3E%3Ccircle cx=\'10\' cy=\'15\' r=\'1.5\' fill=\'rgba(233,213,255,0.7)\'/%3E%3Ccircle cx=\'80\' cy=\'10\' r=\'1\' fill=\'rgba(233,213,255,0.5)\'/%3E%3Ccircle cx=\'50\' cy=\'30\' r=\'2\' fill=\'rgba(233,213,255,0.9)\'/%3E%3Ccircle cx=\'30\' cy=\'60\' r=\'1.2\' fill=\'rgba(233,213,255,0.6)\'/%3E%3Ccircle cx=\'90\' cy=\'70\' r=\'1.8\' fill=\'rgba(233,213,255,0.8)\'/%3E%3Ccircle cx=\'60\' cy=\'90\' r=\'1\' fill=\'rgba(233,213,255,0.5)\'/%3E%3Ccircle cx=\'5\' cy=\'80\' r=\'1.3\' fill=\'rgba(233,213,255,0.7)\'/%3E%3Ccircle cx=\'70\' cy=\'50\' r=\'1.5\' fill=\'rgba(233,213,255,0.9)\'/%3E%3C/svg%3E")',titleIconContent:'',titleIconSvg:'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'currentColor\'%3E%3Cpath d=\'M12,2A10,10,0,0,0,4.2,5.23a1,1,0,0,0,1.28,1.52,7.91,7.91,0,0,1,13.06,0,1,1,0,0,0,1.28-1.52A10,10,0,0,0,12,2Zm0,20a10,10,0,0,0,7.8-3.23,1,1,0,0,0-1.28-1.52,7.91,7.91,0,0,1-13.06,0,1,1,0,1,0-1.28,1.52A10,10,0,0,0,12,22Zm-2-8a2,2,0,1,1,2,2A2,2,0,0,1,10,14Zm6.46-5.8a1,1,0,0,0-1.63-.5,5.92,5.92,0,0,0-9.66,0,1,1,0,1,0-1.63.5,8,8,0,0,1,12.92,0Z\'/%3E%3C/svg%3E")',bgCard:'#1f1d2e',wrapperBorderRadius:'10px',labels:{alignment:'宿命:',power:'位阶:',abilities:'权能:',titles:'尊名:',effects:'迹印:',equipment:'神器:',items:'圣物:',currency:'奇珍:',time:'纪元:',location:'界域:',environment:'万象:',dynamics:'星流:',questMain:'命轨:',questSide:'星尘:',npcPower:'位阶:'},tabNames:{tab1:'万象录',tab2:'神魂谱',tab3:'御万化',optionsTitle:'执枢万象',worldStatus:'根源之海',factions:'神魔序列',inventory:'虚空之戒',nearby:'异界来客',bonded:'魂之共鸣',logTitle:'因果残响:',collapsedCharTitle:'界旅心灯',collapsedWorldTitle:'位面一窥',journal:'神谕残章'}},nihon:{primaryColor:'#ff69b4',glowColor:'rgba(255, 105, 180, 0.6)',accentColor:'#ff9800',bondedColor:'#ffffff',bgPanel:'rgba(40, 20, 30, 0.85)',bgSection:'rgba(20, 5, 15, 0.4)',borderSection:'rgba(233, 30, 99, 0.3)',textMain:'#fce4ec',textHeader:'#e91e63',bgImage:'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Cg fill=\'%23e91e63\' opacity=\'0.1\'%3E%3Cpath d=\'M30 10 C 25 5, 15 5, 10 10 C 5 15, 5 25, 10 30 C 15 35, 25 35, 30 30 C 35 25, 35 15, 30 10 Z\' /%3E%3Cpath d=\'M50 20 C 45 15, 35 15, 30 20 C 25 25, 25 35, 30 40 C 35 45, 45 45, 50 40 C 55 35, 55 25, 50 20 Z\' /%3E%3C/g%3E%3C/svg%3E")',titleIconContent:'🌸',titleIconSvg:'none',bgCard:'#2d1b2d',wrapperBorderRadius:'8px',labels:{alignment:'色纸:',power:'心位:',abilities:'秘传:',titles:'异名:',effects:'胧态:',equipment:'御器:',items:'持物:',currency:'判金:',time:'桜刻:',location:'在処:',environment:'周境:',dynamics:'里话:',questMain:'宿业:',questSide:'露華:',npcPower:'魂胆:'},tabNames:{tab1:'世相记',tab2:'幽玄间',tab3:'心象映',optionsTitle:'露零业行',worldStatus:'八百万神',factions:'浮世绘',inventory:'怀中物',nearby:'一期一会',bonded:'浮世相依',logTitle:'梦日记:',collapsedCharTitle:'樱花御守',collapsedWorldTitle:'缘业一览',journal:'御神签'}}},F={COLLAPSE_TEXT:'隐匿命轮',EXPAND_TEXT:'窥见天机',COLLAPSE_ICON:'❖',EXPAND_ICON:'◈',LAYOUT_FIXED_TEXT:'伸缩自如',LAYOUT_DIFFUSION_TEXT:'能屈能伸',LAYOUT_FIXED_ICON:'⇳',LAYOUT_DIFFUSION_ICON:'↕'},M='fate_console_ui_state',L={theme:'gufeng',collapsed:!1,layout:'diffusion'},O=(0,a.ref)({...L}),P=(0,a.computed)(()=>I[O.value.theme]),X=(0,a.computed)(()=>O.value.theme),U=(0,a.computed)(()=>O.value.collapsed),Q=(0,a.computed)(()=>O.value.layout);function Y(){try{localStorage.setItem(M,JSON.stringify(O.value))}catch(e){console.error('写入记忆失败:',e)}}function H(e){O.value.theme=e,Y()}function j(){O.value.collapsed=!O.value.collapsed,Y()}function Z(){O.value.layout='fixed'===O.value.layout?'diffusion':'fixed',Y()}function R(e){return F[e]}function W(e){return P.value.labels[e]||e}function G(e){return P.value.tabNames[e]}const J={class:'card-front'},K={class:'npc-header'},ee={key:0,class:'npc-status'},te={class:'npc-header-right'},ne={key:0,class:'npc-location'},ae={key:0,class:'progress-bar-group'},oe=['data-negative'],le={class:'progress-bar-text'},ce={class:'info-line'},ie={class:'info-value'},re={class:'info-line'},se={class:'info-label'},pe={class:'info-value'},me={key:1,class:'info-line'},de={class:'info-value'},ue={key:2,class:'info-line'},ve={class:'info-label'},fe={class:'tags-container'},ge={class:'card-back'},ye={class:'npc-header'},be={key:0,class:'npc-status'},Ee={key:0,class:'npc-location'},ke={key:0,class:'progress-bar-group'},Ne=['data-negative'],he={class:'progress-bar-text'},Ve={key:1,class:'progress-bar-group'},Ce={key:0,class:'progress-bar'},Be={class:'progress-bar-text'},we={key:1,class:'progress-bar'},Se={class:'progress-bar-text'},xe={key:2,class:'progress-bar'},De={class:'progress-bar-text'},qe={key:3,class:'progress-bar'},Te={class:'progress-bar-text'},_e={key:2,class:'info-line'},Ae={class:'info-label'},Ie={class:'tags-container'},Fe=(0,a.defineComponent)({__name:'NpcCard',props:{npc:{},bonded:{type:Boolean,default:!1}},emits:['showNpcInventory'],setup(e,{emit:t}){const n=t,o=(0,a.ref)(!1);function l(){o.value=!o.value}function c(e){return e||'状态未知'}function i(e){const t=e.match(/(\d+)\s*\/\s*(\d+)/);if(!t)return'0%';const[,n,a]=t;return`${parseFloat(a)>0?parseFloat(n)/parseFloat(a)*100:0}%`}function r(e){const t=Math.max(-100,Math.min(100,e));if(t>=0)return`${t}%`;return`${Math.abs(t)}%`}function s(e){const t=[];if(e.weapon){e.weapon.split(/,|，/).map(e=>e.trim()).filter(Boolean).forEach(e=>{t.push({name:p(e),color:m(e)})})}if(e.armor){e.armor.split(/,|，/).map(e=>e.trim()).filter(Boolean).forEach(e=>{t.push({name:p(e),color:m(e)})})}if(e.accessories){e.accessories.split(/,|，/).map(e=>e.trim()).filter(Boolean).forEach(e=>{t.push({name:p(e),color:m(e)})})}return t}function p(e){const t=e.match(/^([^(]+)/);return t?t[1].trim():e}function m(e){const t=e.match(/\(([^)]+)\)$/);if(!t)return'#ffffff';return{普通:'#ffffff',精良:'#00ff00',稀有:'#0080ff',史诗:'#ff00ff',传奇:'#ffd700'}[t[1].trim()]||'#ffffff'}return(t,p)=>{return(0,a.openBlock)(),(0,a.createElementBlock)('div',{class:(0,a.normalizeClass)(['npc-card',{bonded:e.bonded,'is-flipped':o.value}]),onClick:l},[(0,a.createElementVNode)('div',J,[(0,a.createElementVNode)('div',K,[(0,a.createElementVNode)('div',null,[(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['npc-name',{'sr-active':e.npc.sr}])},(0,a.toDisplayString)(e.npc.name),3),c(e.npc.status)?((0,a.openBlock)(),(0,a.createElementBlock)('span',ee,'('+(0,a.toDisplayString)(c(e.npc.status))+')',1)):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',te,[e.npc.location?((0,a.openBlock)(),(0,a.createElementBlock)('span',ne,'@ '+(0,a.toDisplayString)(e.npc.location),1)):(0,a.createCommentVNode)('v-if',!0)])]),void 0!==e.npc.affection?((0,a.openBlock)(),(0,a.createElementBlock)('div',ae,[(0,a.createElementVNode)('div',{class:'progress-bar affection-bar','data-negative':e.npc.affection<0},[(0,a.createElementVNode)('div',{class:'progress-bar-fill affection',style:(0,a.normalizeStyle)({width:r(e.npc.affection)})},null,4),(0,a.createElementVNode)('span',le,'缘契：'+(0,a.toDisplayString)(e.npc.affection)+'/100',1)],8,oe)])):(0,a.createCommentVNode)('v-if',!0),(0,a.createElementVNode)('div',ce,[(0,a.createElementVNode)('span',ie,(0,a.toDisplayString)(e.npc.info),1)]),(0,a.createElementVNode)('div',re,[(0,a.createElementVNode)('span',se,(0,a.toDisplayString)((0,a.unref)(W)('npcPower')),1),(0,a.createElementVNode)('span',pe,(0,a.toDisplayString)(e.npc.power),1)]),e.npc.inventory&&(e.npc.inventory.weapon||e.npc.inventory.armor||e.npc.inventory.accessories)?((0,a.openBlock)(),(0,a.createElementBlock)('div',me,[(0,a.createElementVNode)('span',{class:'info-label clickable',onClick:p[0]||(p[0]=t=>{return a=e.npc,(o=t).stopPropagation(),void n('showNpcInventory',a,o);var a,o})},(0,a.toDisplayString)((0,a.unref)(W)('equipment')),1),(0,a.createElementVNode)('span',de,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(s(e.npc.inventory),(t,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:n,style:(0,a.normalizeStyle)({color:t.color}),class:'equipment-item'},(0,a.toDisplayString)(t.name)+(0,a.toDisplayString)(n<s(e.npc.inventory).length-1?' | ':''),5))),128))])])):(0,a.createCommentVNode)('v-if',!0),e.npc.abilities.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',ue,[(0,a.createElementVNode)('span',ve,(0,a.toDisplayString)((0,a.unref)(W)('abilities')),1),(0,a.createElementVNode)('div',fe,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.npc.abilities,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag'},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',ge,[(0,a.createElementVNode)('div',ye,[(0,a.createElementVNode)('div',null,[(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['npc-name',{'sr-active':e.npc.sr}])},(0,a.toDisplayString)(e.npc.name),3),c(e.npc.status)?((0,a.openBlock)(),(0,a.createElementBlock)('span',be,'('+(0,a.toDisplayString)(c(e.npc.status))+')',1)):(0,a.createCommentVNode)('v-if',!0)]),e.npc.location?((0,a.openBlock)(),(0,a.createElementBlock)('span',Ee,'@ '+(0,a.toDisplayString)(e.npc.location),1)):(0,a.createCommentVNode)('v-if',!0)]),void 0!==e.npc.affection?((0,a.openBlock)(),(0,a.createElementBlock)('div',ke,[(0,a.createElementVNode)('div',{class:'progress-bar affection-bar','data-negative':e.npc.affection<0},[(0,a.createElementVNode)('div',{class:'progress-bar-fill affection',style:(0,a.normalizeStyle)({width:r(e.npc.affection)})},null,4),(0,a.createElementVNode)('span',he,'缘契：'+(0,a.toDisplayString)(e.npc.affection)+'/100',1)],8,Ne)])):(0,a.createCommentVNode)('v-if',!0),e.npc.hp||e.npc.mp||e.npc.sta||void 0!==e.npc.sd?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ve,[e.npc.hp?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ce,[(0,a.createElementVNode)('div',{class:'progress-bar-fill hp',style:(0,a.normalizeStyle)({width:i(e.npc.hp)})},null,4),(0,a.createElementVNode)('span',Be,(0,a.toDisplayString)(e.npc.hp),1)])):(0,a.createCommentVNode)('v-if',!0),e.npc.mp?((0,a.openBlock)(),(0,a.createElementBlock)('div',we,[(0,a.createElementVNode)('div',{class:'progress-bar-fill mp',style:(0,a.normalizeStyle)({width:i(e.npc.mp)})},null,4),(0,a.createElementVNode)('span',Se,(0,a.toDisplayString)(e.npc.mp),1)])):(0,a.createCommentVNode)('v-if',!0),e.npc.sta?((0,a.openBlock)(),(0,a.createElementBlock)('div',xe,[(0,a.createElementVNode)('div',{class:'progress-bar-fill sta',style:(0,a.normalizeStyle)({width:i(e.npc.sta)})},null,4),(0,a.createElementVNode)('span',De,(0,a.toDisplayString)(e.npc.sta),1)])):(0,a.createCommentVNode)('v-if',!0),void 0!==e.npc.sd?((0,a.openBlock)(),(0,a.createElementBlock)('div',qe,[(0,a.createElementVNode)('div',{class:'progress-bar-fill sd',style:(0,a.normalizeStyle)({width:Math.max(0,Math.min(100,e.npc.sd))+'%'})},null,4),(0,a.createElementVNode)('span',Te,'缱绻: '+(0,a.toDisplayString)(e.npc.sd)+'/100 '+(0,a.toDisplayString)((m=e.npc.sd,m<=24?'❄️':m<=49?'🌙':m<=74?'🔥':'❤️')),1)])):(0,a.createCommentVNode)('v-if',!0)])):(0,a.createCommentVNode)('v-if',!0),e.npc.effects.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',_e,[(0,a.createElementVNode)('span',Ae,(0,a.toDisplayString)((0,a.unref)(W)('effects')),1),(0,a.createElementVNode)('div',Ie,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.npc.effects,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag'},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0)])],2);var m}}}),Me={class:'npc-select-header'},$e={class:'npc-select-content'},Le={class:'npc-list'},ze=['onClick'],Oe={class:'npc-name'},Pe={key:0,class:'npc-location'},Xe=(0,a.defineComponent)({__name:'NpcSelectMenu',props:{visible:{type:Boolean},position:{},availableNpcs:{},title:{default:'选择对象'}},emits:['select','close'],setup(e,{emit:t}){const n=t;function o(){n('close')}return(t,l)=>e.visible?((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:0,class:'npc-select-overlay',onClick:o},[(0,a.createElementVNode)('div',{class:'npc-select-menu',style:(0,a.normalizeStyle)({left:e.position.x+'px',top:e.position.y+'px'}),onClick:l[0]||(l[0]=(0,a.withModifiers)(()=>{},['stop']))},[(0,a.createElementVNode)('div',Me,[(0,a.createElementVNode)('h4',null,(0,a.toDisplayString)(e.title),1)]),(0,a.createElementVNode)('div',$e,[(0,a.createElementVNode)('div',Le,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.availableNpcs,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'npc-option',onClick:t=>function(e){n('select',e),n('close')}(e)},[(0,a.createElementVNode)('span',Oe,(0,a.toDisplayString)(e.name),1),e.location?((0,a.openBlock)(),(0,a.createElementBlock)('span',Pe,' @ '+(0,a.toDisplayString)(e.location),1)):(0,a.createCommentVNode)('v-if',!0)],8,ze))),128))])])],4)])):(0,a.createCommentVNode)('v-if',!0)}}),Ue=(0,D.A)(Xe,[['__scopeId','data-v-a2228b2a']]),Qe={class:'console-controls'},Ye={class:'theme-switcher'},He=['data-theme','title','onClick'],je=['title'],Ze={class:'icon-fixed'},Re={class:'icon-diffusion'},We=['title'],Ge={class:'icon-collapse'},Je={class:'icon-expand'},Ke={class:'collapsed-view'},et={key:0,class:'collapsed-block'},tt={class:'collapsed-title'},nt={class:'name-status'},at={class:'mb-2 text-lg font-bold'},ot={class:'info-line'},lt={class:'info-label'},ct={class:'info-value'},it={class:'progress-bar-group'},rt={key:0,class:'progress-bar'},st={class:'progress-bar-text'},pt={key:1,class:'progress-bar'},mt={class:'progress-bar-text'},dt={key:2,class:'progress-bar'},ut={class:'progress-bar-text'},vt={key:0,class:'info-line'},ft={class:'info-value'},gt={key:1,class:'info-line'},yt={class:'info-label'},bt={class:'info-value'},Et={key:2,class:'info-line'},kt={class:'info-label'},Nt={class:'tags-container'},ht={key:1,class:'collapsed-block'},Vt={class:'collapsed-title'},Ct={key:0,class:'info-line'},Bt={class:'info-label'},wt={class:'info-value'},St={key:1,class:'info-line'},xt={class:'info-label'},Dt={class:'info-value'},qt={key:2,class:'info-line'},Tt={class:'info-label'},_t={class:'info-value'},At={key:3,class:'info-line'},It={class:'info-label'},Ft={class:'info-value'},Mt={class:'expanded-view'},$t={class:'tab-nav'},Lt={class:'tab-panel-grid'},zt={key:0,class:'grid-column'},Ot={class:'section-box'},Pt={class:'section-title'},Xt={class:'progress-bar-group'},Ut={key:0,class:'progress-bar'},Qt={class:'progress-bar-text'},Yt={key:1,class:'progress-bar'},Ht={class:'progress-bar-text'},jt={key:2,class:'progress-bar'},Zt={class:'progress-bar-text'},Rt={key:0,class:'info-line'},Wt={class:'info-value'},Gt={class:'info-line'},Jt={class:'info-label'},Kt={class:'info-value'},en={class:'info-line'},tn={class:'info-label'},nn={class:'info-value'},an={key:1,class:'info-line'},on={class:'info-label'},ln={class:'tags-container'},cn=['onClick'],rn={key:2,class:'info-line'},sn={class:'info-label'},pn={class:'tags-container'},mn={key:3,class:'info-line'},dn={class:'info-label'},un={class:'tags-container'},vn={key:0,class:'section-box'},fn={class:'section-title'},gn={key:0,class:'info-line'},yn={class:'info-label'},bn={class:'equipped-items'},En={key:0,class:'equipment-line'},kn={class:'equipment-list'},Nn=['onClick'],hn={key:1,class:'equipment-line'},Vn={class:'equipment-list'},Cn=['onClick'],Bn={key:2,class:'equipment-line'},wn={class:'equipment-list'},Sn=['onClick'],xn={key:1,class:'info-line'},Dn={class:'info-label'},qn={class:'tags-container'},Tn=['onClick'],_n={key:2,class:'info-line'},An={class:'info-label'},In={class:'info-value'},Fn={key:1,class:'grid-column'},Mn={class:'section-box'},$n={class:'section-title'},Ln={key:0,class:'info-line'},zn={class:'info-label'},On={class:'info-value'},Pn={key:1,class:'info-line'},Xn={class:'info-label'},Un={class:'info-value'},Qn={key:2,class:'info-line'},Yn={class:'info-label'},Hn={class:'info-value'},jn={key:3,class:'info-line'},Zn={class:'info-label'},Rn={class:'info-value'},Wn={key:0,class:'section-box'},Gn={class:'section-title'},Jn={class:'quest-list'},Kn={class:'info-label'},ea={class:'info-value'},ta=['onClick'],na={key:0,class:'quest-countdown'},aa={key:1,class:'quest-countdown'},oa={key:1,class:'section-box'},la={class:'section-title'},ca={class:'info-label'},ia={class:'info-value'},ra={class:'tab-panel-grid'},sa={class:'grid-column'},pa={class:'section-box'},ma={class:'options-title-container'},da={class:'section-title options-title'},ua={class:'options-grid'},va=['onClick'],fa={class:'option-content'},ga={class:'option-text'},ya={key:0,class:'option-type-attached'},ba={key:0,class:'options-placeholder'},Ea={class:'character-annals-grid'},ka={key:0,class:'grid-column'},Na={class:'section-box bonded-section'},ha={class:'section-title'},Va={class:'npc-grid'},Ca={key:1,class:'grid-column'},Ba={class:'section-box'},wa={class:'section-title'},Sa={class:'npc-grid'},xa={key:0,class:'log-container'},Da={class:'log-title'},qa={class:'log-box'},Ta=(0,a.defineComponent)({__name:'app',setup(e){const t=(0,a.computed)(()=>function(){try{const e=getChatMessages(getCurrentMessageId())[0].message.match(/<fate_console>([\s\S]*?)<\/fate_console>/);if(!e||!e[1])return null;const t='<root>'+e[1].trim()+'</root>',n=(new DOMParser).parseFromString(t,'text/xml');if(n.querySelector('parsererror'))throw new Error('XML Parsing Error.');const a=(e,t=n)=>t.querySelector(e),o=(e,t=n)=>t.querySelectorAll(e),l=(e,t=n)=>t.querySelector(e)?.textContent||'',c={nearbyNpcs:[],bondedNpcs:[],options:[],log:l('log')},i=n.querySelector('character');if(i){const e=a('name',i),t=e?.textContent?.trim()||'',o=e?.getAttribute('alias')?.trim();c.character={name:t,alias:o,status:l('status',i),alignment:l('alignment',i).trim(),power:l('power',i).trim(),info:l('info',i).trim(),ov:parseInt(a('info',i)?.getAttribute('ov')||'0',10),kv:parseInt(a('info',i)?.getAttribute('kv')||'0',10),abilities:T(l('abilities',i)),titles:T(o),effects:T(l('effects',i)),thought:l('thought',i).trim()};const r=a('status',i);Object.assign(c.character,A(r));const s=n.querySelector('inventory');if(s){const e=a('items',s);c.character.inventory={items:T(l('items',s)),currency:l('currency',s).trim(),weapon:e?.getAttribute('weapon')?.trim()||'',armor:e?.getAttribute('armor')?.trim()||'',accessories:e?.getAttribute('accessories')?.trim()||''}}}const r=n.querySelector('world');r&&(c.world={time:l('time',r).trim(),location:l('location',r).trim(),environment:l('environment',r).trim(),dynamics:l('dynamics',r).trim(),quests:[],factions:[]},o('journal > quest').forEach(e=>{const t=e.getAttribute('type')||'支线',n=e.textContent?.trim()||'',a=e.getAttribute('bcd')?.trim(),o=e.getAttribute('ecd')?.trim();c.world.quests.push({type:t,content:n,bcd:a,ecd:o})}),o('factions > faction').forEach(e=>{const t=e.getAttribute('name')||'',n=e.textContent?.trim()||'';c.world.factions.push({name:t,value:n})}));const s=e=>{const t=l('name',e).trim(),n=l('status',e),o=e.getAttribute('sr'),c=e.getAttribute('sd'),i=e.getAttribute('affection'),r={name:t,info:l('info',e).trim(),power:l('power',e).trim(),status:n,location:e.getAttribute('location')?.trim(),sr:'是'===o,sd:c?parseInt(c,10):void 0,affection:i?parseInt(i,10):void 0,abilities:T(l('abilities',e)),effects:T(l('effects',e))},s=a('items',e);if(s){const t=l('items',e);r.inventory={items:t?T(t):[],weapon:s.getAttribute('weapon')?.trim()||'',armor:s.getAttribute('armor')?.trim()||'',accessories:s.getAttribute('accessories')?.trim()||''}}const p=a('status',e);return Object.assign(r,A(p)),r};o('nearby_npcs > npc').forEach(e=>{c.nearbyNpcs.push(s(e))}),o('bonded_characters > npc').forEach(e=>{c.bondedNpcs.push(s(e))});const p=n.querySelector('options');return p&&o('option',p).forEach(e=>{const t=e.getAttribute('id')||'',n=e.getAttribute('type')||'',a='true'===e.getAttribute('disabled'),o=e.textContent?.trim()||'';c.options.push({id:t,content:o,type:n,disabled:a})}),c}catch(e){return console.error('命运终端数据解析失败:',e),null}}()),n=(0,a.ref)('fate-scroll'),o=['gufeng','xianxia','minsu','wuxia','xuanhuan','nihon'],l=(0,a.ref)({visible:!1,type:'ability',title:'',position:{x:0,y:0},target:null,equipmentType:'',isEquipped:!1,maxQuantity:99}),c=(0,a.ref)({visible:!1,position:{x:0,y:0},itemName:'',quantity:1,actionType:'give',title:'选择对象'}),i=(0,a.computed)(()=>({'console-wrapper':!0,[`theme-${X.value}`]:'gufeng'!==X.value,collapsed:U.value,'fixed-layout':'fixed'===Q.value})),r=(0,a.computed)(()=>U.value?R('EXPAND_TEXT'):R('COLLAPSE_TEXT')),s=(0,a.computed)(()=>R('EXPAND_ICON')),p=(0,a.computed)(()=>R('COLLAPSE_ICON')),m=(0,a.computed)(()=>'fixed'===Q.value?R('LAYOUT_FIXED_TEXT'):R('LAYOUT_DIFFUSION_TEXT')),d=(0,a.computed)(()=>R('LAYOUT_FIXED_ICON')),u=(0,a.computed)(()=>R('LAYOUT_DIFFUSION_ICON')),v=(0,a.computed)(()=>t.value?.log?t.value.log.split(/\r?\n/).filter(e=>''!==e.trim()).map(e=>e.trim()):[]);function f(e){return{gufeng:'古风',xianxia:'仙侠',minsu:'民俗',wuxia:'武侠',xuanhuan:'玄幻',nihon:'日式'}[e]||e}function g(e,t,n){const a=l.value.target;var o;'ability'===l.value.type?'use'===e?function(e){console.log('Using ability:',e);const t=window.parent.document.querySelector('#send_textarea');if(t){const n=t.value,a=n?'\n':'';t.value=n+a+`使用：${e}`,t.dispatchEvent(new Event('input',{bubbles:!0})),t.focus()}else console.warn('Chat input textarea not found')}(a):'study'===e&&function(e){console.log('Studying ability:',e);const t=window.parent.document.querySelector('#send_textarea');if(t){const n=t.value,a=n?'\n':'';t.value=n+a+`研习：${e}`,t.dispatchEvent(new Event('input',{bubbles:!0})),t.focus()}else console.warn('Chat input textarea not found')}(a):'item'===l.value.type?'use'===e&&t?function(e,t){console.log(`Using ${t} of item:`,e);const n=window.parent.document.querySelector('#send_textarea');if(n){const a=n.value,o=a?'\n':'';n.value=a+o+`使用：${e} x${t}`,n.dispatchEvent(new Event('input',{bubbles:!0})),n.focus()}else console.warn('Chat input textarea not found')}(a,t):'give'===e&&t?function(e,t){console.log(`Giving ${t} of item:`,e),c.value={visible:!0,position:{x:300,y:200},itemName:e,quantity:t,actionType:'give',title:'选择给予对象'}}(a,t):'discard'===e&&t&&function(e,t){console.log(`Discarding ${t} of item:`,e);const n=window.parent.document.querySelector('#send_textarea');if(n){const a=n.value,o=a?'\n':'';n.value=a+o+`丢弃：${e} x${t}`,n.dispatchEvent(new Event('input',{bubbles:!0})),n.focus()}else console.warn('Chat input textarea not found')}(a,t):'quest'===l.value.type?'start'===e?function(e){console.log('Starting quest:',e);const t=window.parent.document.querySelector('#send_textarea');if(t){const n=t.value,a=n?'\n':'',o=N(e);t.value=n+a+`开始任务：${o}`,t.dispatchEvent(new Event('input',{bubbles:!0})),t.focus()}else console.warn('Chat input textarea not found')}(a):'abandon'===e&&function(e){console.log('Abandoning quest:',e);const t=window.parent.document.querySelector('#send_textarea');if(t){const n=t.value,a=n?'\n':'',o=N(e);t.value=n+a+`放弃任务：${o}`,t.dispatchEvent(new Event('input',{bubbles:!0})),t.focus()}else console.warn('Chat input textarea not found')}(a):'equipment'===l.value.type?'equip'===e?function(e){console.log('Equipping item:',e);const t=window.parent.document.querySelector('#send_textarea');if(t){const n=t.value,a=n?'\n':'';t.value=n+a+`装备：${e}`,t.dispatchEvent(new Event('input',{bubbles:!0})),t.focus()}else console.warn('Chat input textarea not found')}(a):'unequip'===e?function(e,t){console.log('Unequipping item:',e,'from',t);const n=window.parent.document.querySelector('#send_textarea');if(n){const t=n.value,a=t?'\n':'';n.value=t+a+`卸下：${e}`,n.dispatchEvent(new Event('input',{bubbles:!0})),n.focus()}else console.warn('Chat input textarea not found')}(a,l.value.equipmentType):'give'===e?(o=a,console.log('Giving item:',o),c.value={visible:!0,position:{x:300,y:200},itemName:o,quantity:1,actionType:'give',title:'选择给予对象'}):'discard'===e&&function(e,t){console.log('Discarding equipped item:',e,'from',t);const n=window.parent.document.querySelector('#send_textarea');if(n){const t=n.value,a=t?'\n':'';n.value=t+a+`丢弃：${e}`,n.dispatchEvent(new Event('input',{bubbles:!0})),n.focus()}else console.warn('Chat input textarea not found')}(a,l.value.equipmentType):'rest'===l.value.type?'nap'===e?function(){console.log('Taking a nap');const e=window.parent.document.querySelector('#send_textarea');if(e){const t=e.value,n=t?'\n':'';e.value=t+n+'小憩一会儿，暂时不想其他的事情。',e.dispatchEvent(new Event('input',{bubbles:!0})),e.focus()}else console.warn('Chat input textarea not found')}():'sleep'===e?function(){console.log('Going to sleep');const e=window.parent.document.querySelector('#send_textarea');if(e){const t=e.value,n=t?'\n':'';e.value=t+n+'直接就寝，时间来到第二天。',e.dispatchEvent(new Event('input',{bubbles:!0})),e.focus()}else console.warn('Chat input textarea not found')}():'invite'===e&&(console.log('Inviting to sleep'),c.value={visible:!0,position:{x:300,y:200},itemName:'邀请共寝',quantity:1,actionType:'invite',title:'选择邀请对象'}):'npc_inventory'===l.value.type&&'steal'===e&&n&&function(e,t){if(console.log('Stealing items from',e.name,':',t),0===t.length)return;const n=window.parent.document.querySelector('#send_textarea');if(n){const a=n.value,o=a?'\n':'',l=t.join('、');n.value=a+o+`偷窃：${e.name}的${l}`,n.dispatchEvent(new Event('input',{bubbles:!0})),n.focus()}else console.warn('Chat input textarea not found')}(a,n)}function y(){l.value.visible=!1}function b(){const e=[];return t.value?.bondedNpcs&&t.value.bondedNpcs.forEach(t=>{e.push({name:t.name,location:t.location})}),t.value?.nearbyNpcs&&t.value.nearbyNpcs.forEach(t=>{e.push({name:t.name,location:t.location})}),e}function E(e){const t=c.value.itemName,n=c.value.quantity,a=c.value.actionType,o=window.parent.document.querySelector('#send_textarea');if(o){const l=o.value,c=l?'\n':'';let i='';if('give'===a){const a=n>1?` x${n}`:'';i=`给予${e.name}：${t}${a}`}else'invite'===a&&(i=`邀请${e.name}共寝，并不打算轻易睡去。`);o.value=l+c+i,o.dispatchEvent(new Event('input',{bubbles:!0})),o.focus()}else console.warn('Chat input textarea not found');k()}function k(){c.value.visible=!1}function N(e){const t=e.match(/^\(([^)]+)\)/);return t?t[1]:e}function h(e){return e||'状态未知'}function V(){return t.value?.character?.ov||0}function C(){return t.value?.character?.kv||0}function B(e,t){let n,a;return console.log('Calculating alignment with OV:',e,'KV:',t),n=e<=-33?'混乱':e<=33?'中立':'守序',a=t<=-33?'邪恶':t<=33?'中立':'善良',console.log('Mapped to lawfulness:',n,'goodness:',a),'守序'===n&&'善良'===a?'守序善良':'守序'===n&&'中立'===a?'守序中立':'守序'===n&&'邪恶'===a?'守序邪恶':'中立'===n&&'善良'===a?'中立善良':'中立'===n&&'中立'===a?'绝对中立':'中立'===n&&'邪恶'===a?'中立邪恶':'混乱'===n&&'善良'===a?'混乱善良':'混乱'===n&&'中立'===a?'混乱中立':'混乱'===n&&'邪恶'===a?'混乱邪恶':'未知阵营'}function w(e){const t=e.match(/(\d+)\s*\/\s*(\d+)/);if(!t)return'0%';const[,n,a]=t;return`${parseFloat(a)>0?parseFloat(n)/parseFloat(a)*100:0}%`}function S(e){return e<-33?'#FFA500':e>33?'#00BFFF':'#6b7280'}function x(e){return e<-33?'#DC143C':e>33?'#00FF7F':'#6b7280'}function D(e){return e.split(/,|，/).map(e=>{const t=e.trim(),n=function(e){const t=e.match(/^([^(]+)/);return t?t[1].trim():e}(t),a=function(e){const t=e.match(/\(([^)]+)\)$/);if(!t)return'#ffffff';const n=t[1].trim();return{普通:'#ffffff',精良:'#00ff00',稀有:'#0080ff',史诗:'#ff00ff',传奇:'#ffd700'}[n]||'#ffffff'}(t);return{name:n,color:a}})}function I(){const e=t.value?.character?.inventory;return!!(e?.weapon||e?.armor||e?.accessories)}function F(e,t,n){console.log('Showing equipment menu for:',e,t),l.value={visible:!0,type:'equipment',title:`${e}`,position:{x:n.clientX,y:n.clientY},target:e,equipmentType:t,isEquipped:!0,maxQuantity:99}}function P(e,t){console.log('Showing NPC inventory for:',e.name),l.value={visible:!0,type:'npc_inventory',title:`${e.name}的物品`,position:{x:t.clientX,y:t.clientY},target:e,equipmentType:'',isEquipped:!1,maxQuantity:99}}return(0,a.onMounted)(()=>{!function(){try{const e=localStorage.getItem(M);if(e){const t=JSON.parse(e);O.value={...L,...t}}}catch(e){console.error('读取记忆失败:',e)}}()}),(e,T)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{class:(0,a.normalizeClass)(['fate-console',i.value])},[(0,a.createCommentVNode)(' 控制面板 '),(0,a.createElementVNode)('div',Qe,[(0,a.createElementVNode)('div',Ye,[((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(o,e=>(0,a.createElementVNode)('div',{key:e,class:(0,a.normalizeClass)(['theme-stone',{active:(0,a.unref)(X)===e}]),'data-theme':e,title:f(e),onClick:t=>(0,a.unref)(H)(e)},null,10,He)),64))]),(0,a.createElementVNode)('div',{id:'layout-toggle-btn',class:'console-control-btn',title:m.value,onClick:T[0]||(T[0]=(...e)=>(0,a.unref)(Z)&&(0,a.unref)(Z)(...e))},[(0,a.createElementVNode)('span',Ze,(0,a.toDisplayString)(d.value),1),(0,a.createElementVNode)('span',Re,(0,a.toDisplayString)(u.value),1)],8,je),(0,a.createElementVNode)('div',{id:'console-toggle-btn',class:'console-control-btn',title:r.value,onClick:T[1]||(T[1]=(...e)=>(0,a.unref)(j)&&(0,a.unref)(j)(...e))},[(0,a.createElementVNode)('span',Ge,(0,a.toDisplayString)(p.value),1),(0,a.createElementVNode)('span',Je,(0,a.toDisplayString)(s.value),1)],8,We)]),(0,a.createCommentVNode)(' 折叠视图 '),(0,a.createElementVNode)('div',Ke,[t.value?.character?((0,a.openBlock)(),(0,a.createElementBlock)('div',et,[(0,a.createElementVNode)('h3',tt,(0,a.toDisplayString)((0,a.unref)(G)('collapsedCharTitle')),1),(0,a.createElementVNode)('div',nt,[(0,a.createElementVNode)('div',at,(0,a.toDisplayString)(t.value.character.name)+' - '+(0,a.toDisplayString)(h(t.value.character.status)),1),(0,a.createElementVNode)('div',ot,[(0,a.createElementVNode)('span',lt,(0,a.toDisplayString)((0,a.unref)(W)('alignment')),1),(0,a.createElementVNode)('span',ct,(0,a.toDisplayString)(B(V(),C())),1),(0,a.createElementVNode)('div',{class:'alignment-circle ov-circle',style:(0,a.normalizeStyle)({background:S(V())})},(0,a.toDisplayString)(V()),5),(0,a.createElementVNode)('div',{class:'alignment-circle kv-circle',style:(0,a.normalizeStyle)({background:x(C())})},(0,a.toDisplayString)(C()),5)])]),(0,a.createElementVNode)('div',it,[t.value.character.hp?((0,a.openBlock)(),(0,a.createElementBlock)('div',rt,[(0,a.createElementVNode)('div',{class:'progress-bar-fill hp',style:(0,a.normalizeStyle)({width:w(t.value.character.hp)})},null,4),(0,a.createElementVNode)('span',st,(0,a.toDisplayString)(t.value.character.hp),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.character.mp?((0,a.openBlock)(),(0,a.createElementBlock)('div',pt,[(0,a.createElementVNode)('div',{class:'progress-bar-fill mp',style:(0,a.normalizeStyle)({width:w(t.value.character.mp)})},null,4),(0,a.createElementVNode)('span',mt,(0,a.toDisplayString)(t.value.character.mp),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.character.sta?((0,a.openBlock)(),(0,a.createElementBlock)('div',dt,[(0,a.createElementVNode)('div',{class:'progress-bar-fill sta',style:(0,a.normalizeStyle)({width:w(t.value.character.sta)})},null,4),(0,a.createElementVNode)('span',ut,(0,a.toDisplayString)(t.value.character.sta),1)])):(0,a.createCommentVNode)('v-if',!0)]),t.value.character.info?((0,a.openBlock)(),(0,a.createElementBlock)('div',vt,[(0,a.createElementVNode)('span',ft,(0,a.toDisplayString)(t.value.character.info),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.character.power?((0,a.openBlock)(),(0,a.createElementBlock)('div',gt,[(0,a.createElementVNode)('span',yt,(0,a.toDisplayString)((0,a.unref)(W)('power')),1),(0,a.createElementVNode)('span',bt,(0,a.toDisplayString)(t.value.character.power),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.character.effects.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',Et,[(0,a.createElementVNode)('span',kt,(0,a.toDisplayString)((0,a.unref)(W)('effects')),1),(0,a.createElementVNode)('div',Nt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.character.effects,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag'},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0)])):(0,a.createCommentVNode)('v-if',!0),t.value?.world?((0,a.openBlock)(),(0,a.createElementBlock)('div',ht,[(0,a.createElementVNode)('h3',Vt,(0,a.toDisplayString)((0,a.unref)(G)('collapsedWorldTitle')),1),t.value.world.time?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ct,[(0,a.createElementVNode)('span',Bt,(0,a.toDisplayString)((0,a.unref)(W)('time')),1),(0,a.createElementVNode)('span',wt,(0,a.toDisplayString)(t.value.world.time),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.world.location?((0,a.openBlock)(),(0,a.createElementBlock)('div',St,[(0,a.createElementVNode)('span',xt,(0,a.toDisplayString)((0,a.unref)(W)('location')),1),(0,a.createElementVNode)('span',Dt,(0,a.toDisplayString)(t.value.world.location),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.world.environment?((0,a.openBlock)(),(0,a.createElementBlock)('div',qt,[(0,a.createElementVNode)('span',Tt,(0,a.toDisplayString)((0,a.unref)(W)('environment')),1),(0,a.createElementVNode)('span',_t,(0,a.toDisplayString)(t.value.world.environment),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.world.dynamics?((0,a.openBlock)(),(0,a.createElementBlock)('div',At,[(0,a.createElementVNode)('span',It,(0,a.toDisplayString)((0,a.unref)(W)('dynamics')),1),(0,a.createElementVNode)('span',Ft,(0,a.toDisplayString)(t.value.world.dynamics),1)])):(0,a.createCommentVNode)('v-if',!0)])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createCommentVNode)(' 展开视图 '),(0,a.createElementVNode)('div',Mt,[(0,a.createElementVNode)('nav',$t,[(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)(['tab-btn',{active:'fate-scroll'===n.value}]),onClick:T[2]||(T[2]=e=>n.value='fate-scroll')},(0,a.toDisplayString)((0,a.unref)(G)('tab1')),3),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)(['tab-btn',{active:'annals'===n.value}]),onClick:T[3]||(T[3]=e=>n.value='annals')},(0,a.toDisplayString)((0,a.unref)(G)('tab2')),3),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)(['tab-btn',{active:'fate-scroll-2'===n.value}]),onClick:T[4]||(T[4]=e=>n.value='fate-scroll-2')},(0,a.toDisplayString)((0,a.unref)(G)('tab3')),3)]),(0,a.createCommentVNode)(' 山河册/天机卷/风物志/武林谱/万象录 标签页 '),(0,a.createElementVNode)('div',{id:'fate-scroll',class:(0,a.normalizeClass)(['tab-panel',{active:'fate-scroll'===n.value}])},[(0,a.createElementVNode)('div',Lt,[(0,a.createCommentVNode)(' 角色信息列 '),t.value?.character?((0,a.openBlock)(),(0,a.createElementBlock)('div',zt,[(0,a.createElementVNode)('div',Ot,[(0,a.createElementVNode)('h2',Pt,[(0,a.createElementVNode)('span',{class:'char-name clickable',onClick:T[5]||(T[5]=e=>{return t=e,console.log('Showing rest menu'),void(l.value={visible:!0,type:'rest',title:'休息选项',position:{x:t.clientX,y:t.clientY},target:null,equipmentType:'',isEquipped:!1,maxQuantity:99});var t})},(0,a.toDisplayString)(t.value.character.name),1),T[6]||(T[6]=(0,a.createElementVNode)('span',null,'-',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(h(t.value.character.status)),1)]),(0,a.createElementVNode)('div',Xt,[t.value.character.hp?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ut,[(0,a.createElementVNode)('div',{class:'progress-bar-fill hp',style:(0,a.normalizeStyle)({width:w(t.value.character.hp)})},null,4),(0,a.createElementVNode)('span',Qt,(0,a.toDisplayString)(t.value.character.hp),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.character.mp?((0,a.openBlock)(),(0,a.createElementBlock)('div',Yt,[(0,a.createElementVNode)('div',{class:'progress-bar-fill mp',style:(0,a.normalizeStyle)({width:w(t.value.character.mp)})},null,4),(0,a.createElementVNode)('span',Ht,(0,a.toDisplayString)(t.value.character.mp),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.character.sta?((0,a.openBlock)(),(0,a.createElementBlock)('div',jt,[(0,a.createElementVNode)('div',{class:'progress-bar-fill sta',style:(0,a.normalizeStyle)({width:w(t.value.character.sta)})},null,4),(0,a.createElementVNode)('span',Zt,(0,a.toDisplayString)(t.value.character.sta),1)])):(0,a.createCommentVNode)('v-if',!0)]),t.value.character.info?((0,a.openBlock)(),(0,a.createElementBlock)('div',Rt,[(0,a.createElementVNode)('span',Wt,(0,a.toDisplayString)(t.value.character.info),1)])):(0,a.createCommentVNode)('v-if',!0),(0,a.createElementVNode)('div',Gt,[(0,a.createElementVNode)('span',Jt,(0,a.toDisplayString)((0,a.unref)(W)('alignment')),1),(0,a.createElementVNode)('span',Kt,(0,a.toDisplayString)(B(V(),C())),1),(0,a.createElementVNode)('div',{class:'alignment-circle ov-circle',style:(0,a.normalizeStyle)({background:S(V())})},(0,a.toDisplayString)(V()),5),(0,a.createElementVNode)('div',{class:'alignment-circle kv-circle',style:(0,a.normalizeStyle)({background:x(C())})},(0,a.toDisplayString)(C()),5)]),(0,a.createElementVNode)('div',en,[(0,a.createElementVNode)('span',tn,(0,a.toDisplayString)((0,a.unref)(W)('power')),1),(0,a.createElementVNode)('span',nn,(0,a.toDisplayString)(t.value.character.power),1)]),t.value.character.abilities.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',an,[(0,a.createElementVNode)('span',on,(0,a.toDisplayString)((0,a.unref)(W)('abilities')),1),(0,a.createElementVNode)('div',ln,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.character.abilities,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag clickable',onClick:t=>function(e,t){console.log('Showing ability menu for:',e),l.value={visible:!0,type:'ability',title:`${e}`,position:{x:t.clientX,y:t.clientY},target:e,equipmentType:'',isEquipped:!1,maxQuantity:99}}(e,t)},(0,a.toDisplayString)(e),9,cn))),128))])])):(0,a.createCommentVNode)('v-if',!0),t.value.character.titles.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',rn,[(0,a.createElementVNode)('span',sn,(0,a.toDisplayString)((0,a.unref)(W)('titles')),1),(0,a.createElementVNode)('div',pn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.character.titles,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag'},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0),t.value.character.effects.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',mn,[(0,a.createElementVNode)('span',dn,(0,a.toDisplayString)((0,a.unref)(W)('effects')),1),(0,a.createElementVNode)('div',un,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.character.effects,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag'},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createCommentVNode)(' 物品栏 '),t.value.character.inventory?((0,a.openBlock)(),(0,a.createElementBlock)('div',vn,[(0,a.createElementVNode)('h2',fn,(0,a.toDisplayString)((0,a.unref)(G)('inventory')),1),(0,a.createCommentVNode)(' 穿戴装备 '),I()?((0,a.openBlock)(),(0,a.createElementBlock)('div',gn,[(0,a.createElementVNode)('span',yn,(0,a.toDisplayString)((0,a.unref)(W)('equipment')),1),(0,a.createElementVNode)('div',bn,[t.value.character.inventory.weapon?((0,a.openBlock)(),(0,a.createElementBlock)('div',En,[T[7]||(T[7]=(0,a.createElementVNode)('span',{class:'equipment-icon'},'⚔️',-1)),(0,a.createElementVNode)('span',kn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(D(t.value.character.inventory.weapon),(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:n,style:(0,a.normalizeStyle)({color:e.color}),class:'equipment-item clickable',onClick:t=>F(e.name,'weapon',t)},(0,a.toDisplayString)(e.name)+(0,a.toDisplayString)(n<D(t.value.character.inventory.weapon).length-1?', ':''),13,Nn))),128))])])):(0,a.createCommentVNode)('v-if',!0),t.value.character.inventory.armor?((0,a.openBlock)(),(0,a.createElementBlock)('div',hn,[T[8]||(T[8]=(0,a.createElementVNode)('span',{class:'equipment-icon'},'🛡️',-1)),(0,a.createElementVNode)('span',Vn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(D(t.value.character.inventory.armor),(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:n,style:(0,a.normalizeStyle)({color:e.color}),class:'equipment-item clickable',onClick:t=>F(e.name,'armor',t)},(0,a.toDisplayString)(e.name)+(0,a.toDisplayString)(n<D(t.value.character.inventory.armor).length-1?', ':''),13,Cn))),128))])])):(0,a.createCommentVNode)('v-if',!0),t.value.character.inventory.accessories?((0,a.openBlock)(),(0,a.createElementBlock)('div',Bn,[T[9]||(T[9]=(0,a.createElementVNode)('span',{class:'equipment-icon'},'💎',-1)),(0,a.createElementVNode)('span',wn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(D(t.value.character.inventory.accessories),(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:n,style:(0,a.normalizeStyle)({color:e.color}),class:'equipment-item clickable',onClick:t=>F(e.name,'accessories',t)},(0,a.toDisplayString)(e.name)+(0,a.toDisplayString)(n<D(t.value.character.inventory.accessories).length-1?', ':''),13,Sn))),128))])])):(0,a.createCommentVNode)('v-if',!0)])])):(0,a.createCommentVNode)('v-if',!0),t.value.character.inventory.items?.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',xn,[(0,a.createElementVNode)('span',Dn,(0,a.toDisplayString)((0,a.unref)(W)('items')),1),(0,a.createElementVNode)('div',qn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.character.inventory.items,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag clickable',onClick:t=>function(e,t){if(console.log('Showing item menu for:',e),!e.match(/\((普通|精良|稀有|史诗|传奇)\)$/)){const n=e.match(/\((\d+)\)$/),a=n?parseInt(n[1],10):1,o=e.replace(/\s*\(\d+\)$/,'');l.value={visible:!0,type:'item',title:`${o}`,position:{x:t.clientX,y:t.clientY},target:o,equipmentType:'',isEquipped:!1,maxQuantity:a}}else{const n=e.replace(/\s*\([^)]+\)$/,'');l.value={visible:!0,type:'equipment',title:`${n}`,position:{x:t.clientX,y:t.clientY},target:n,equipmentType:'weapon',isEquipped:!1,maxQuantity:99}}}(e,t)},(0,a.toDisplayString)(e),9,Tn))),128))])])):(0,a.createCommentVNode)('v-if',!0),t.value.character.inventory.currency?((0,a.openBlock)(),(0,a.createElementBlock)('div',_n,[(0,a.createElementVNode)('span',An,(0,a.toDisplayString)((0,a.unref)(W)('currency')),1),(0,a.createElementVNode)('span',In,(0,a.toDisplayString)(t.value.character.inventory.currency),1)])):(0,a.createCommentVNode)('v-if',!0)])):(0,a.createCommentVNode)('v-if',!0)])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 世界信息列 '),t.value?.world?((0,a.openBlock)(),(0,a.createElementBlock)('div',Fn,[(0,a.createElementVNode)('div',Mn,[(0,a.createElementVNode)('h2',$n,(0,a.toDisplayString)((0,a.unref)(G)('worldStatus')),1),t.value.world.time?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ln,[(0,a.createElementVNode)('span',zn,(0,a.toDisplayString)((0,a.unref)(W)('time')),1),(0,a.createElementVNode)('span',On,(0,a.toDisplayString)(t.value.world.time),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.world.location?((0,a.openBlock)(),(0,a.createElementBlock)('div',Pn,[(0,a.createElementVNode)('span',Xn,(0,a.toDisplayString)((0,a.unref)(W)('location')),1),(0,a.createElementVNode)('span',Un,(0,a.toDisplayString)(t.value.world.location),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.world.environment?((0,a.openBlock)(),(0,a.createElementBlock)('div',Qn,[(0,a.createElementVNode)('span',Yn,(0,a.toDisplayString)((0,a.unref)(W)('environment')),1),(0,a.createElementVNode)('span',Hn,(0,a.toDisplayString)(t.value.world.environment),1)])):(0,a.createCommentVNode)('v-if',!0),t.value.world.dynamics?((0,a.openBlock)(),(0,a.createElementBlock)('div',jn,[(0,a.createElementVNode)('span',Zn,(0,a.toDisplayString)((0,a.unref)(W)('dynamics')),1),(0,a.createElementVNode)('span',Rn,(0,a.toDisplayString)(t.value.world.dynamics),1)])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createCommentVNode)(' 任务日志 '),t.value.world.quests.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',Wn,[(0,a.createElementVNode)('h2',Gn,(0,a.toDisplayString)((0,a.unref)(G)('journal')),1),(0,a.createElementVNode)('div',Jn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.world.quests,e=>{return(0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.content,class:(0,a.normalizeClass)(['info-line','quest-'+('主线'===e.type?'main':'side')])},[(0,a.createElementVNode)('span',Kn,(0,a.toDisplayString)((0,a.unref)(W)('主线'===e.type?'questMain':'questSide')),1),(0,a.createElementVNode)('span',ea,[(0,a.createElementVNode)('span',{class:'quest-title clickable',onClick:t=>function(e,t){console.log('Showing quest menu for:',e),l.value={visible:!0,type:'quest',title:`任务：${N(e.content)}`,position:{x:t.clientX,y:t.clientY},target:e.content,equipmentType:'',isEquipped:!1,maxQuantity:99}}(e,t)},(0,a.toDisplayString)(N(e.content)),9,ta),(0,a.createTextVNode)(' '+(0,a.toDisplayString)((t=e.content,t.replace(/^\([^)]+\)\s*/,'')))+' ',1),void 0!==e.bcd?((0,a.openBlock)(),(0,a.createElementBlock)('span',na,'未开始：'+(0,a.toDisplayString)(e.bcd)+'后开始',1)):void 0!==e.ecd?((0,a.openBlock)(),(0,a.createElementBlock)('span',aa,'进行中：'+(0,a.toDisplayString)(e.ecd)+'后结束',1)):(0,a.createCommentVNode)('v-if',!0)])],2);var t}),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 派系 '),t.value.world.factions.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',oa,[(0,a.createElementVNode)('h2',la,(0,a.toDisplayString)((0,a.unref)(G)('factions')),1),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.world.factions,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'info-line'},[(0,a.createElementVNode)('span',ca,(0,a.toDisplayString)(e.name)+':',1),(0,a.createElementVNode)('span',ia,(0,a.toDisplayString)(e.value),1)]))),128))])):(0,a.createCommentVNode)('v-if',!0)])):(0,a.createCommentVNode)('v-if',!0)])],2),(0,a.createCommentVNode)(' 第三个标签页 - 选项区域 '),(0,a.createElementVNode)('div',{id:'fate-scroll-2',class:(0,a.normalizeClass)(['tab-panel',{active:'fate-scroll-2'===n.value}])},[(0,a.createElementVNode)('div',ra,[(0,a.createElementVNode)('div',sa,[(0,a.createElementVNode)('div',pa,[(0,a.createElementVNode)('div',ma,[(0,a.createElementVNode)('h2',da,(0,a.toDisplayString)((0,a.unref)(G)('optionsTitle')),1)]),(0,a.createElementVNode)('div',ua,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value?.options,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.id,class:(0,a.normalizeClass)(['option-card',{disabled:e.disabled}]),onClick:t=>!e.disabled&&function(e){console.log('Selected option:',e);const t=window.parent.document.querySelector('#send_textarea');if(t){const n=t.value,a=n?'\n':'';t.value=n+a+e.content,t.dispatchEvent(new Event('input',{bubbles:!0})),t.focus()}else console.warn('Chat input textarea not found')}(e)},[(0,a.createElementVNode)('div',fa,[(0,a.createElementVNode)('span',ga,[(0,a.createTextVNode)((0,a.toDisplayString)(e.content),1),e.type?((0,a.openBlock)(),(0,a.createElementBlock)('span',ya,'('+(0,a.toDisplayString)(e.type)+')',1)):(0,a.createCommentVNode)('v-if',!0)])])],10,va))),128)),t.value?.options?.length?(0,a.createCommentVNode)('v-if',!0):((0,a.openBlock)(),(0,a.createElementBlock)('div',ba,'暂无选项'))])])])])],2),(0,a.createCommentVNode)(' 衣冠谱/仙缘录/异闻录/恩仇录/神魂谱 标签页 '),(0,a.createElementVNode)('div',{id:'annals',class:(0,a.normalizeClass)(['tab-panel',{active:'annals'===n.value}])},[(0,a.createElementVNode)('div',Ea,[(0,a.createCommentVNode)(' 羁绊角色 '),t.value?.bondedNpcs.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',ka,[(0,a.createElementVNode)('div',Na,[(0,a.createElementVNode)('h2',ha,(0,a.toDisplayString)((0,a.unref)(G)('bonded')),1),(0,a.createElementVNode)('div',Va,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.bondedNpcs,e=>((0,a.openBlock)(),(0,a.createBlock)(Fe,{key:e.name,npc:e,bonded:!0,onShowNpcInventory:P},null,8,['npc']))),128))])])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 附近NPC '),t.value?.nearbyNpcs.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ca,[(0,a.createElementVNode)('div',Ba,[(0,a.createElementVNode)('h2',wa,(0,a.toDisplayString)((0,a.unref)(G)('nearby')),1),(0,a.createElementVNode)('div',Sa,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value.nearbyNpcs,e=>((0,a.openBlock)(),(0,a.createBlock)(Fe,{key:e.name,npc:e,bonded:!1,onShowNpcInventory:P},null,8,['npc']))),128))])])])):(0,a.createCommentVNode)('v-if',!0)])],2)]),(0,a.createCommentVNode)(' 日志区域 '),t.value?.log?((0,a.openBlock)(),(0,a.createElementBlock)('div',xa,[(0,a.createElementVNode)('h3',Da,(0,a.toDisplayString)((0,a.unref)(G)('logTitle')),1),(0,a.createElementVNode)('div',qa,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(v.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('p',{key:e,class:'log-entry'},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 动作菜单 '),(0,a.createVNode)(q,{visible:l.value.visible,type:l.value.type,title:l.value.title,position:l.value.position,'max-quantity':l.value.maxQuantity,'is-equipped':l.value.isEquipped,target:l.value.target,onSelect:g,onClose:y},null,8,['visible','type','title','position','max-quantity','is-equipped','target']),(0,a.createCommentVNode)(' NPC选择菜单 '),(0,a.createVNode)(Ue,{visible:c.value.visible,position:c.value.position,'available-npcs':b(),title:c.value.title,'action-type':c.value.actionType,onSelect:E,onClose:k},null,8,['visible','position','available-npcs','title','action-type'])],2))}}),_a=(0,n.createRouter)({history:(0,n.createMemoryHistory)(),routes:[{path:'/',component:Ta}]});_a.replace('/'),$(()=>{(0,a.createApp)(Ta).use(_a).mount('#app')});</script><style>.action-menu-overlay[data-v-ee0818f6]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.3);z-index:1000;display:flex;align-items:center;justify-content:center}.action-menu[data-v-ee0818f6]{background:var(--bg-panel);border:2px solid var(--primary-color);border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.5);min-width:200px;max-width:400px;z-index:1001}.action-menu-header[data-v-ee0818f6]{padding:12px 16px;border-bottom:1px solid var(--border-section);background:var(--bg-section)}.action-menu-header h4[data-v-ee0818f6]{margin:0;color:var(--text-header);font-size:1.1em;font-weight:bold}.action-menu-content[data-v-ee0818f6]{padding:12px 16px}.action-menu-content .action-btn[data-v-ee0818f6]{display:block;width:100%;padding:8px 12px;margin:4px 0;background:var(--primary-color);color:#000;font-weight:bold;border:none;border-radius:4px;cursor:pointer;font-size:.9em;transition:all .2s ease}.action-menu-content .action-btn[data-v-ee0818f6]:hover{background:var(--glow-color);transform:translateY(-1px)}.action-menu-content .quantity-input[data-v-ee0818f6]{display:flex;align-items:center;gap:4px;margin-bottom:12px}.action-menu-content .quantity-input label[data-v-ee0818f6]{color:var(--text-main);font-size:.9em}.action-menu-content .quantity-input .quantity-controls[data-v-ee0818f6]{display:flex;align-items:center;gap:2px}.action-menu-content .quantity-input .quantity-controls .quantity-btn[data-v-ee0818f6]{width:24px;height:24px;padding:0;border:1px solid var(--border-section);border-radius:4px;background:var(--bg-card);color:var(--text-main);font-size:1em;font-weight:bold;display:flex;align-items:center;justify-content:center;transition:transform .2s ease}.action-menu-content .quantity-input .quantity-controls .quantity-btn[data-v-ee0818f6]:hover:not(:disabled){background:var(--bg-card);border-color:var(--border-section)}.action-menu-content .quantity-input .quantity-controls .quantity-btn[data-v-ee0818f6]:active:not(:disabled){transform:scale(0.95)}.action-menu-content .quantity-input .quantity-controls .quantity-btn[data-v-ee0818f6]:disabled{cursor:not-allowed;opacity:.5}.action-menu-content .quantity-input .quantity-controls .quantity-field[data-v-ee0818f6]{width:50px;padding:4px 6px;border:1px solid var(--border-section);border-radius:4px;background:var(--bg-card);color:var(--text-main);text-align:center;-webkit-appearance:none;appearance:textfield}.action-menu-content .quantity-input .quantity-controls .quantity-field[data-v-ee0818f6]:focus{outline:none;border-color:var(--primary-color)}.action-menu-content .quantity-input .quantity-controls .quantity-field[data-v-ee0818f6]::-webkit-outer-spin-button,.action-menu-content .quantity-input .quantity-controls .quantity-field[data-v-ee0818f6]::-webkit-inner-spin-button{-webkit-appearance:none;appearance:none;margin:0}.action-menu-content .quantity-input .quantity-controls .quantity-field[data-v-ee0818f6]::-moz-number-spin-box{display:none}.action-menu-content .quantity-input .quantity-max[data-v-ee0818f6]{color:var(--text-main);font-size:.9em;opacity:.8}.action-menu-content .npc-inventory-content[data-v-ee0818f6]{max-height:300px;overflow-y:auto}.action-menu-content .npc-inventory-content .inventory-section[data-v-ee0818f6]{margin-bottom:16px}.action-menu-content .npc-inventory-content .inventory-section h5[data-v-ee0818f6]{margin:0 0 8px 0;color:var(--text-header);font-size:1em;font-weight:bold;border-bottom:1px solid var(--border-section);padding-bottom:4px}.action-menu-content .npc-inventory-content .inventory-section .inventory-items .inventory-item[data-v-ee0818f6]{display:flex;align-items:center;gap:8px;margin-bottom:4px;padding:4px;border-radius:4px;background:var(--bg-card);border:1px solid var(--border-section)}.action-menu-content .npc-inventory-content .inventory-section .inventory-items .inventory-item .item-checkbox[data-v-ee0818f6]{margin:0;width:16px;height:16px}.action-menu-content .npc-inventory-content .inventory-section .inventory-items .inventory-item .item-label[data-v-ee0818f6]{flex:1;cursor:pointer;font-size:.9em;color:var(--text-main);margin:0}.action-menu-content .npc-inventory-content .inventory-section .inventory-items .inventory-item[data-v-ee0818f6]:hover{background:var(--bg-card);border-color:var(--primary-color)}.action-menu-content .steal-btn[data-v-ee0818f6]{background:crimson !important;color:#fff !important}.action-menu-content .steal-btn[data-v-ee0818f6]:hover:not(:disabled){background:#b22222 !important}.action-menu-content .steal-btn[data-v-ee0818f6]:disabled{background:#666 !important;cursor:not-allowed;opacity:.6}
.npc-select-overlay[data-v-a2228b2a]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.3);z-index:1000;display:flex;align-items:center;justify-content:center}.npc-select-menu[data-v-a2228b2a]{background:var(--bg-panel);border:2px solid var(--primary-color);border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.5);min-width:200px;max-width:300px;z-index:1001}.npc-select-header[data-v-a2228b2a]{padding:12px 16px;border-bottom:1px solid var(--border-section);background:var(--bg-section)}.npc-select-header h4[data-v-a2228b2a]{margin:0;color:var(--text-header);font-size:1.1em;font-weight:bold}.npc-select-content[data-v-a2228b2a]{padding:8px 0;max-height:300px;overflow-y:auto}.npc-select-content .npc-list .npc-option[data-v-a2228b2a]{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;cursor:pointer;transition:background-color .2s ease}.npc-select-content .npc-list .npc-option[data-v-a2228b2a]:hover{background:var(--bg-card)}.npc-select-content .npc-list .npc-option .npc-name[data-v-a2228b2a]{color:var(--text-main);font-weight:500}.npc-select-content .npc-list .npc-option .npc-location[data-v-a2228b2a]{color:var(--text-secondary);font-size:.9em}
:root{--bg-card:#2a231c;--card-texture:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAD5JREFUKFN1jKENADAIAsie//9n7g5W1sAIgtA54h7M47n4LpweR45zYAUkI5Oi6VEvrp/fGBsQhAEd8q23fQGWbALfWzvxjAAAAABJRU5ErkJggg==");--font-header:"Ma Shan Zheng",cursive;--font-body:"Noto Serif SC",serif;--primary-color:#c89b3c;--glow-color:rgba(255,215,0,0.6);--accent-color:#e74c3c;--bonded-color:#f472b6;--bg-panel:rgba(30,25,20,0.85);--bg-section:rgba(10,5,0,0.4);--border-section:rgba(200,155,60,0.3);--text-main:#f0e6d2;--text-header:var(--primary-color);--hp-color:#c0392b;--mp-color:#2980b9;--sta-color:#27ae60;--sd-color:#e879f9;--affection-color:#f1c40f;--bg-image:url("https://www.transparenttextures.com/patterns/old-wall.png");--title-icon-content:"";--title-icon-svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20ZM15,8H9V16h6Z'/%3E%3C/svg%3E");--wrapper-border-radius:10px}.theme-xianxia{--primary-color:#34d399;--glow-color:rgba(167,243,208,0.7);--accent-color:#f59e0b;--bonded-color:#e53e3e;--bg-panel:rgba(15,30,25,0.85);--bg-section:rgba(5,15,10,0.4);--border-section:rgba(52,211,153,0.3);--text-main:#e0f2f1;--text-header:var(--primary-color);--bg-image:url("https://www.transparenttextures.com/patterns/gplay.png");--title-icon-content:"☯";--title-icon-svg:none;--bg-card:#182825}.theme-minsu{--primary-color:#ef4444;--glow-color:rgba(252,165,165,0.7);--accent-color:#facc15;--bonded-color:var(--accent-color);--bg-panel:rgba(40,10,10,0.85);--bg-section:rgba(20,0,0,0.4);--border-section:rgba(239,68,68,0.3);--text-main:#fef2f2;--text-header:#fca5a5;--bg-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Cg fill='%23a11d1d' opacity='0.35'%3E%3Cpath d='M15 8 C 10 5, 5 10, 8 15 L 12 18 C 15 22, 22 20, 20 15 Z' /%3E%3Ccircle cx='50' cy='10' r='5' /%3E%3Cellipse cx='65' cy='60' rx='8' ry='4' transform='rotate(45 65 60)' /%3E%3Cpath d='M30 70 C 25 75, 35 80, 40 75 L 42 72 C 45 68, 38 65, 35 68 Z' /%3E%3Ccircle cx='10' cy='50' r='3' /%3E%3Ccircle cx='70' cy='30' r='2' /%3E%3C/g%3E%3C/svg%3E");--title-icon-content:"🏮";--title-icon-svg:none;--bg-card:#3a1a1a}.theme-wuxia{--primary-color:#e5e7eb;--glow-color:rgba(255,255,255,0.3);--accent-color:#dc2626;--bonded-color:#34d399;--bg-panel:rgba(17,24,39,0.9);--bg-section:rgba(31,41,55,0.5);--border-section:rgba(229,231,235,0.3);--text-main:#f9fafb;--text-header:var(--primary-color);--bg-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40'%3E%3Cpath d='M0 10 H15 V25 H0 V40 H30 V10 H40 V0 H10 V-10' fill='none' stroke='rgba(229, 231, 235, 0.15)' stroke-width='2'/%3E%3C/svg%3E");--title-icon-content:"";--title-icon-svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12.5,2C10.8,2,9.5,3.3,9.5,5s1.3,3,3,3,3-1.3,3-3S14.2,2,12.5,2z M12,9C7.58,9,4,12.58,4,17s3.58,8,8,8,8-3.58,8-8S16.42,9,12,9z'/%3E%3C/svg%3E");--wrapper-border-radius:2px;--bg-card:#2c3342}.theme-xuanhuan{--primary-color:#8b5cf6;--glow-color:rgba(196,181,253,0.6);--accent-color:#38bdf8;--bonded-color:var(--accent-color);--bg-panel:rgba(5,5,15,0.9);--bg-section:rgba(0,0,0,0.4);--border-section:rgba(139,92,246,0.3);--text-main:#e9d5ff;--text-header:#c4b5fd;--bg-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect width='100' height='100' fill='rgba(5,5,15,0)'/%3E%3Ccircle cx='10' cy='15' r='1.5' fill='rgba(233,213,255,0.7)'/%3E%3Ccircle cx='80' cy='10' r='1' fill='rgba(233,213,255,0.5)'/%3E%3Ccircle cx='50' cy='30' r='2' fill='rgba(233,213,255,0.9)'/%3E%3Ccircle cx='30' cy='60' r='1.2' fill='rgba(233,213,255,0.6)'/%3E%3Ccircle cx='90' cy='70' r='1.8' fill='rgba(233,213,255,0.8)'/%3E%3Ccircle cx='60' cy='90' r='1' fill='rgba(233,213,255,0.5)'/%3E%3Ccircle cx='5' cy='80' r='1.3' fill='rgba(233,213,255,0.7)'/%3E%3Ccircle cx='70' cy='50' r='1.5' fill='rgba(233,213,255,0.9)'/%3E%3C/svg%3E");--title-icon-content:"";--title-icon-svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12,2A10,10,0,0,0,4.2,5.23a1,1,0,0,0,1.28,1.52,7.91,7.91,0,0,1,13.06,0,1,1,0,0,0,1.28-1.52A10,10,0,0,0,12,2Zm0,20a10,10,0,0,0,7.8-3.23,1,1,0,0,0-1.28-1.52,7.91,7.91,0,0,1-13.06,0,1,1,0,1,0-1.28,1.52A10,10,0,0,0,12,22Zm-2-8a2,2,0,1,1,2,2A2,2,0,0,1,10,14Zm6.46-5.8a1,1,0,0,0-1.63-.5,5.92,5.92,0,0,0-9.66,0,1,1,0,1,0-1.63.5,8,8,0,0,1,12.92,0Z'/%3E%3C/svg%3E");--bg-card:#1f1d2e}.theme-nihon{--primary-color:#ff69b4;--glow-color:rgba(255,105,180,0.6);--accent-color:#ff9800;--bonded-color:#ffffff;--bg-panel:rgba(40,20,30,0.85);--bg-section:rgba(20,5,15,0.4);--border-section:rgba(233,30,99,0.3);--text-main:#fce4ec;--text-header:#e91e63;--bg-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Cg fill='%23e91e63' opacity='0.1'%3E%3Cpath d='M30 10 C 25 5, 15 5, 10 10 C 5 15, 5 25, 10 30 C 15 35, 25 35, 30 30 C 35 25, 35 15, 30 10 Z' /%3E%3Cpath d='M50 20 C 45 15, 35 15, 30 20 C 25 25, 25 35, 30 40 C 35 45, 45 45, 50 40 C 55 35, 55 25, 50 20 Z' /%3E%3C/g%3E%3C/svg%3E");--title-icon-content:"🌸";--title-icon-svg:none;--bg-card:#2d1b2d}.fate-console{position:relative;font-family:var(--font-body);background-color:var(--bg-panel);background-image:var(--bg-image);border:3px solid rgba(0,0,0,0);border-image:linear-gradient(to bottom right,var(--primary-color),#ffd700,var(--primary-color)) 1;border-radius:var(--wrapper-border-radius);padding:15px;padding-top:45px;margin:10px 0;box-shadow:0 0 20px var(--glow-color),inset 0 0 15px rgba(0,0,0,.7),0 0 0 1px hsla(0,0%,100%,.1),0 4px 8px rgba(0,0,0,.3);color:var(--text-main);backdrop-filter:blur(3px);transition:all .4s ease-in-out;animation:fade-in .6s ease-out}.fate-console::before{content:"";position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(255,255,255,0.1) 3px,rgba(255,255,255,0.1) 6px),repeating-linear-gradient(90deg,transparent,transparent 3px,rgba(255,255,255,0.1) 3px,rgba(255,255,255,0.1) 6px),linear-gradient(135deg,var(--primary-color),transparent,var(--primary-color));background-size:20px 20px,20px 20px,100% 100%;border-radius:var(--wrapper-border-radius);opacity:.3;animation:border-pattern 8s linear infinite;pointer-events:none;-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:xor;-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;padding:2px}@keyframes border-pattern{0%{background-position:0 0,0 0,0 0}100%{background-position:20px 20px,20px 20px,100% 100%}}.theme-xianxia .fate-console{border-image:none;border:3px solid rgba(0,0,0,0);box-shadow:0 0 10px var(--primary-color),0 0 25px var(--glow-color),inset 0 0 15px rgba(0,0,0,.7)}.theme-minsu .fate-console{border-image:none;border:3px dashed var(--primary-color)}.theme-wuxia .fate-console{border-image-source:url("data:image/svg+xml;charset=utf-8,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle%3Epath%7Bfill:%23e5e7eb%7D%3C/style%3E%3Cpath d='M2.1-2.1c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM10.3 6.1c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM18.4 14.2c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM26.5 22.3c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM34.6 30.4c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM42.7 38.5c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM50.8 46.6c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM58.9 54.7c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM67.1 62.9c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM75.2 71c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM83.3 79.1c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0zM91.4 87.2c-1.7 1.7-1.7 4.5 0 6.1l6.1 6.1c1.7 1.7 4.5 1.7 6.1 0l-6.1-6.1c-1.7-1.7-4.4-1.7-6.1 0z'/%3E%3C/svg%3E");border-image-slice:5;border-image-width:5px;border-image-repeat:stretch;border-width:5px}.theme-xuanhuan .fate-console{border-image:none;border:3px solid rgba(0,0,0,0);box-shadow:0 0 8px var(--glow-color),0 0 16px var(--primary-color),0 0 24px var(--accent-color),inset 0 0 15px rgba(0,0,0,.7)}.theme-nihon .fate-console{border-image:none;border:3px solid rgba(0,0,0,0);box-shadow:0 0 10px var(--glow-color),0 0 20px var(--primary-color),inset 0 0 15px rgba(0,0,0,.7)}.theme-nihon .section-title::before{background-color:rgba(0,0,0,0);filter:drop-shadow(0 0 3px var(--primary-color))}@keyframes fade-in{from{opacity:0;transform:scale(0.98)}to{opacity:1;transform:scale(1)}}@keyframes rotate-slow{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes shake{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-2px)}20%,40%,60%,80%{transform:translateX(2px)}}@keyframes sway{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}@keyframes card-glow{0%,100%{box-shadow:0 6px 20px rgba(0,0,0,.5),0 0 8px var(--glow-color),0 0 15px var(--primary-color),inset 0 1px 3px rgba(0,0,0,.5)}50%{box-shadow:0 8px 25px rgba(0,0,0,.6),0 0 12px var(--glow-color),0 0 20px var(--primary-color),inset 0 1px 3px rgba(0,0,0,.5)}}@keyframes bonded-card-glow{0%,100%{box-shadow:0 6px 20px rgba(0,0,0,.4),0 0 15px var(--bonded-color),0 0 25px var(--bonded-color),inset 0 1px 3px rgba(0,0,0,.5)}50%{box-shadow:0 8px 25px rgba(0,0,0,.5),0 0 20px var(--bonded-color),0 0 35px var(--bonded-color),inset 0 1px 3px rgba(0,0,0,.5)}}@keyframes button-click{0%{transform:scale(1)}50%{transform:scale(0.95)}100%{transform:scale(1)}}.console-controls{position:absolute;top:10px;right:12px;display:flex;align-items:center;gap:15px;z-index:10}.console-control-btn{font-size:1.6em;color:var(--primary-color);cursor:pointer;transition:transform .2s,color .2s;font-family:sans-serif}.console-control-btn:hover{color:var(--glow-color);transform:scale(1.15)}.fate-console.collapsed .console-control-btn .icon-collapse{display:none}.fate-console.collapsed .console-control-btn .icon-expand{display:block}.fate-console.fixed-layout .console-control-btn .icon-fixed{display:none}.fate-console.fixed-layout .console-control-btn .icon-diffusion{display:block}.icon-expand,.icon-diffusion{display:none}.theme-switcher{display:flex;gap:6px}.theme-stone{width:18px;height:18px;border-radius:50%;cursor:pointer;border:2px solid hsla(0,0%,100%,.3);transition:all .2s}.theme-stone:hover{transform:scale(1.2)}.theme-stone.active{border-color:#fff;transform:scale(1.1);box-shadow:0 0 10px #fff}.theme-stone[data-theme=gufeng]{background:#c89b3c}.theme-stone[data-theme=xianxia]{background:#34d399}.theme-stone[data-theme=minsu]{background:#ef4444}.theme-stone[data-theme=wuxia]{background:#e5e7eb}.theme-stone[data-theme=xuanhuan]{background:#8b5cf6}.theme-stone[data-theme=nihon]{background:#e91e63}.collapsed-view{display:none}.fate-console.collapsed{padding:15px;padding-top:45px}.fate-console.collapsed .expanded-view,.fate-console.collapsed .log-container{display:none}.fate-console.collapsed .collapsed-view{display:grid;grid-template-columns:1fr 1fr;gap:12px}.collapsed-block{background:var(--bg-section);border:1px solid var(--border-section);border-radius:6px;padding:10px 12px}.collapsed-title{font-family:"Ma Shan Zheng","华文行楷","华文楷体","KaiTi",cursive;font-size:1.5em;color:var(--text-header);margin-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:normal;letter-spacing:.15em;text-shadow:0 0 8px var(--glow-color);transform:rotate(-1deg)}.fate-console.fixed-layout .expanded-view{height:70vw;overflow-y:auto;padding-right:8px;scrollbar-width:thin;scrollbar-color:var(--primary-color) rgba(0,0,0,.2)}.fate-console.fixed-layout .expanded-view::-webkit-scrollbar{width:6px}.fate-console.fixed-layout .expanded-view::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:3px}.fate-console.fixed-layout .expanded-view::-webkit-scrollbar-thumb{background-color:var(--primary-color);border-radius:3px}.tab-nav{display:flex;gap:5px;border-bottom:2px solid var(--primary-color);margin-bottom:15px}.tab-btn{font-family:"Ma Shan Zheng","华文行楷","华文楷体","KaiTi",cursive;font-size:1.8em;color:gray;background:rgba(0,0,0,.2);border:2px solid var(--primary-color);border-bottom:none;padding:5px 20px;border-radius:8px 8px 0 0;cursor:pointer;transform:translateY(2px);transition:all .2s ease;font-weight:normal;letter-spacing:.08em}.tab-btn:hover{color:var(--text-header);background:rgba(50,40,30,.4)}.tab-btn.active{color:var(--text-header);background:var(--bg-section);border-color:var(--primary-color);text-shadow:0 0 8px var(--glow-color)}.tab-panel{display:none}.tab-panel.active{display:block;animation:fade-in .4s}.tab-panel-grid,.character-annals-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:20px}.grid-column{display:flex;flex-direction:column;gap:15px}.section-box{background:var(--bg-section);border:1px solid var(--border-section);border-radius:6px;padding:12px;overflow:hidden;position:relative}.section-box::before{content:"";position:absolute;top:-1px;left:-1px;right:-1px;bottom:-1px;background:linear-gradient(135deg,transparent 0%,var(--primary-color) 20%,transparent 40%,var(--primary-color) 60%,transparent 80%,var(--primary-color) 100%);background-size:200% 200%;border-radius:6px;opacity:.2;animation:section-glow 4s ease-in-out infinite alternate;pointer-events:none}@keyframes section-glow{0%{opacity:.1;background-position:0% 0%}100%{opacity:.3;background-position:100% 100%}}.section-title{font-family:"Ma Shan Zheng","华文行楷","华文楷体","KaiTi",cursive;font-size:1.8em;color:var(--text-header);text-shadow:0 0 8px var(--glow-color);padding-bottom:10px;margin:0 0 10px 0;display:flex;align-items:center;justify-content:center;gap:10px;border-bottom:none;font-weight:normal;letter-spacing:.1em;position:relative}.section-title::before{content:var(--title-icon-content,"");font-family:sans-serif;font-size:1.2em;color:var(--primary-color);display:inline-block;width:1.2em;height:1.2em;line-height:1.2em;text-align:center;flex-shrink:0;background-color:var(--primary-color);-webkit-mask-image:var(--title-icon-svg);mask-image:var(--title-icon-svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:contain;mask-size:contain;-webkit-mask-position:center;mask-position:center}.theme-xianxia .section-title::before,.theme-minsu .section-title::before{background-color:rgba(0,0,0,0)}.theme-xianxia .section-title::before{animation:rotate-slow 8s linear infinite}.theme-nihon .section-title::before{animation:rotate-slow 6s linear infinite reverse}.theme-minsu .section-title::before{animation:sway 4s ease-in-out infinite}.section-title::after{content:"";flex-grow:1;height:1px;background:linear-gradient(to right,var(--primary-color),transparent)}.char-name{font-size:1.2em;font-weight:bold}.progress-bar-group{display:flex;flex-direction:column;gap:8px;margin:10px 0}.progress-bar{width:100%;height:20px;background-color:#2c1d12;border-radius:5px;overflow:hidden;position:relative;border:1px solid #4a3c2d;box-shadow:inset 0 1px 3px rgba(0,0,0,.5);box-sizing:border-box}.progress-bar-fill{height:100%;transition:width .5s ease-in-out;background-image:repeating-linear-gradient(-45deg,transparent,transparent 5px,rgba(255,255,255,0.1) 5px,rgba(255,255,255,0.1) 10px)}.progress-bar-fill.hp{background-color:var(--hp-color)}.progress-bar-fill.mp{background-color:var(--mp-color)}.progress-bar-fill.sta{background-color:var(--sta-color)}.progress-bar-fill.sd{background-color:var(--sd-color)}.progress-bar-fill.affection{background-color:var(--affection-color)}.progress-bar-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:.8em;font-weight:bold;text-shadow:1px 1px 2px #000;white-space:nowrap}.info-line{display:flex;margin:6px 0;align-items:baseline}.alignment-circles{display:flex;gap:6px;margin-left:8px;align-items:center}.alignment-circle{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75em;font-weight:bold;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.8);border:1px solid hsla(0,0%,100%,.3);box-shadow:0 2px 4px rgba(0,0,0,.2);transition:transform .2s ease}.alignment-circle:hover{transform:scale(1.1)}.ov-circle{background:linear-gradient(135deg,#3b82f6,#1d4ed8)}.kv-circle{background:linear-gradient(135deg,#8b5cf6,#7c3aed)}.info-label{color:var(--text-header);font-weight:bold;margin-right:8px;white-space:nowrap;flex-shrink:0}.tags-container{display:flex;flex-wrap:wrap;gap:6px;margin-top:5px}.tag{background:rgba(200,155,60,.15);border:1px solid var(--primary-color);color:var(--text-main);padding:3px 10px;border-radius:4px;font-size:.85em}.tag.clickable{cursor:pointer;transition:all .2s ease}.tag.clickable:hover{background:rgba(200,155,60,.3);border-color:var(--glow-color);transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.2)}.quest-title{background:rgba(200,155,60,.15);border:1px solid var(--primary-color);color:var(--text-main);padding:3px 10px;border-radius:4px;font-size:1em;font-weight:bold;cursor:pointer;transition:all .2s ease}.quest-title:hover{background:rgba(200,155,60,.3);border-color:var(--glow-color);transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.2)}.equipped-items{display:flex;flex-direction:column;gap:6px;margin-top:8px}.equipment-line{display:flex;align-items:center;gap:8px}.equipment-icon{font-size:1.2em;min-width:20px;text-align:center}.equipment-list{flex:1;line-height:1.4}.equipment-item{font-weight:bold;margin-right:4px}.quest-list .info-line{border-left:3px solid var(--primary-color);padding-left:10px}.quest-list .quest-main .info-label{color:#f1c40f}.quest-list .quest-side .info-label{color:#3498db}.quest-countdown{display:inline;font-size:.85em;color:var(--text-header);opacity:.8;margin-left:8px;font-style:italic}.npc-grid{display:grid;grid-template-columns:1fr;gap:15px}.bonded-section .section-title::after{content:"∞";color:var(--bonded-color);font-size:1.2em;animation:pulse-red 2.5s infinite ease-in-out;background:none;margin-left:auto;flex-grow:0}@keyframes pulse-red{0%{opacity:.7}50%{opacity:1}100%{opacity:.7}}.npc-card{position:relative;cursor:pointer;border:1px solid var(--primary-color);border-radius:8px;padding:10px;box-sizing:border-box;box-shadow:inset 0 1px 3px rgba(0,0,0,.5);transition:transform .3s ease,box-shadow .3s ease,border-color .3s ease;background:linear-gradient(145deg,rgba(255,255,255,0.08),transparent),var(--card-texture),var(--bg-card)}.npc-card:hover{transform:translateY(-5px) scale(1.03);border-color:var(--primary-color);box-shadow:0 6px 20px rgba(0,0,0,.5),0 0 8px var(--glow-color),0 0 15px var(--primary-color),inset 0 1px 3px rgba(0,0,0,.5)}.npc-card::after{content:"↺";position:absolute;bottom:5px;right:10px;color:var(--primary-color);opacity:.5;transition:opacity .3s,transform .3s;z-index:5}.npc-card:hover::after{opacity:1;transform:rotate(360deg)}.npc-card.bonded{border-color:var(--bonded-color);box-shadow:0 0 10px var(--bonded-color),inset 0 1px 3px rgba(0,0,0,.5)}.npc-card.bonded:hover{border-color:var(--bonded-color);animation:bonded-card-glow 2s ease-in-out infinite}.npc-card.bonded::after{color:var(--bonded-color)}.npc-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px dashed var(--primary-color);padding-bottom:5px;margin-bottom:8px;flex-shrink:0}.npc-info-section{margin-right:20px}.npc-name{font-size:1.2em;font-weight:bold;color:#e67e22}.npc-name.sr-active{color:#ff6b6b}.npc-status{font-size:.9em;color:var(--text-main);font-weight:normal;margin-left:6px}.npc-location{font-size:.8em;color:#bdc3c7;font-style:italic}.affection-bar-horizontal{width:100%;height:8px;background:rgba(0,0,0,.3);border-radius:4px;margin-top:8px;overflow:hidden;border:1px solid hsla(0,0%,100%,.2)}.affection-fill-horizontal{height:100%;transition:all .5s ease;border-radius:3px}.affection-fill.affection{background:#e91e63}.affection-fill.affection.affection-gray{background:#7f8c8d}.affection-fill.affection.affection-white{background:#fff}.affection-fill.affection.affection-yellow{background:#f1c40f}.affection-fill.affection.affection-pink{background:#e91e63}.progress-bar-fill.affection{background:var(--affection-color)}.affection-bar{position:relative}.affection-bar .progress-bar-fill.affection{background:var(--affection-color);background-image:repeating-linear-gradient(-45deg,transparent,transparent 5px,rgba(255,255,255,0.1) 5px,rgba(255,255,255,0.1) 10px);transition:background-color .3s ease}.affection-bar[data-negative=true] .progress-bar-fill.affection{background:linear-gradient(135deg,#87ceeb,#add8e6);background-image:repeating-linear-gradient(-45deg,transparent,transparent 5px,rgba(255,255,255,0.2) 5px,rgba(255,255,255,0.2) 10px);box-shadow:inset 0 0 8px rgba(173,216,230,.8)}.affection-bar[data-negative=true]{border:2px solid skyblue;box-shadow:inset 0 0 10px rgba(173,216,230,.5)}.affection-bar[data-negative=true]::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,rgba(173,216,230,0.2) 0%,transparent 25%,rgba(173,216,230,0.2) 50%,transparent 75%,rgba(173,216,230,0.2) 100%);background-size:20px 20px;animation:ice-effect 2s linear infinite;pointer-events:none}@keyframes ice-effect{0%{background-position:0 0}100%{background-position:20px 20px}}.card-front{display:block}.card-back{display:none}.is-flipped .card-front{display:none}.is-flipped .card-back{display:block;animation:fade-in .3s}.log-container{margin-top:15px}.log-title{font-family:"Ma Shan Zheng","华文行楷","华文楷体","KaiTi",cursive;margin:0 0 8px 4px;color:var(--text-main);font-size:1em;font-weight:normal;letter-spacing:.05em;text-shadow:0 0 5px var(--glow-color)}.log-box{background:rgba(0,0,0,.4);border-left:4px solid var(--primary-color);padding:8px 12px;max-height:3.7rem;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--primary-color) rgba(0,0,0,.2)}.log-box::-webkit-scrollbar{width:6px}.log-box::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:3px}.log-box::-webkit-scrollbar-thumb{background-color:var(--primary-color);border-radius:3px}.log-entry{margin:0 0 5px;font-style:italic;color:#bdc3c7;line-height:1.5}.log-entry:last-child{margin-bottom:0}.options-placeholder{color:var(--text-main);opacity:.7;font-style:italic;text-align:center;padding:20px}.options-section{display:block;padding:0}.options-grid{display:flex;flex-direction:column;gap:8px;width:100%;padding:20px;padding-top:60px}.options-title-container{position:relative;width:100%;margin-bottom:20px}.options-title{text-align:center;justify-content:center;position:absolute;left:50%;top:0;transform:translateX(-50%);z-index:10;background:rgba(0,0,0,0);padding:0 10px}.option-card{position:relative;cursor:pointer;border:1px solid var(--primary-color);border-radius:8px;padding:8px 30px;box-sizing:border-box;box-shadow:inset 0 1px 3px rgba(0,0,0,.5),0 0 15px rgba(200,155,60,.15),0 2px 4px rgba(0,0,0,.1);transition:transform .3s ease,box-shadow .3s ease,border-color .3s ease;background:linear-gradient(145deg,rgba(255,255,255,0.1),rgba(200,155,60,0.02)),radial-gradient(circle at 30% 30%,rgba(255,215,0,0.05) 0%,transparent 50%),radial-gradient(circle at 70% 70%,rgba(200,155,60,0.03) 0%,transparent 50%),var(--bg-card);width:100%;display:flex;flex-direction:column;min-height:40px;justify-content:center}.option-card::before{content:"✦";position:absolute;top:50%;left:8px;transform:translateY(-50%);color:var(--primary-color);font-size:1.4em;opacity:.8;pointer-events:none}.option-card::after{content:"✦";position:absolute;top:50%;right:8px;transform:translateY(-50%);color:var(--primary-color);font-size:1.4em;opacity:.8;pointer-events:none}.option-card:hover{transform:translateY(-3px) scale(1.02);border-color:var(--primary-color);box-shadow:0 4px 15px rgba(0,0,0,.3),0 0 8px var(--glow-color),0 0 12px var(--primary-color),inset 0 1px 3px rgba(0,0,0,.5)}.option-card:active{transform:translateY(-1px) scale(0.98);transition:transform .1s ease}.option-card.disabled{opacity:.5;cursor:not-allowed;border-color:#666}.option-card.disabled:hover{transform:none;box-shadow:inset 0 1px 3px rgba(0,0,0,.5)}.option-header{display:none}.option-id{display:none}.option-type{font-size:.9em;color:var(--text-header);background:rgba(200,155,60,.2);padding:2px 8px;border-radius:4px;border:1px solid var(--primary-color)}.option-content{color:var(--text-main);line-height:1.4;white-space:pre-wrap;text-align:center;flex:1;display:flex;align-items:center;justify-content:center;min-height:30px}.option-text{display:inline;font-size:1.2em;font-family:"KaiTi","楷体","楷体_GB2312",serif;font-weight:normal;letter-spacing:.05em}@media (max-width:768px){.fate-console{padding:10px;padding-top:45px}.tab-panel-grid,.character-annals-grid,.fate-console.collapsed .collapsed-view{grid-template-columns:1fr;gap:15px}.tab-btn{font-size:1.4em;padding:5px 10px}.section-title{font-size:1.5em}.console-controls{gap:8px;right:8px}.theme-stone{width:16px;height:16px}.console-control-btn{font-size:1.4em}.fate-console.fixed-layout .expanded-view{height:120vw}.options-grid{padding:15px;padding-top:50px}.option-card{min-height:35px}}
</style></head><body><div id="app"></div></body>